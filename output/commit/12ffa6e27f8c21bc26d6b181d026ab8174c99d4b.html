<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Research/hicbrowser implement top-left design change cors setting for the loop and genomic data from google cloud bucket Â· personal-web-2025@12ffa6e</title>
    <style>
        
        :root {
          --c-indigo-1: #3451b2;
          --c-indigo-2: #3a5ccc;
          --c-indigo-3: #5672cd;
          --c-green: #1a7f37;
          --c-red: #c53030;
          --c-yellow: #9a6700;
          --c-dir: #54aeff;
          --c-gray-soft: rgba(142, 150, 170, .14);
          --c-bg: #ffffff;
          --c-bg-alt: #f6f6f7;
          --c-bg-elv: #ffffff;
          --c-text-1: rgba(60, 60, 67);
          --c-text-2: rgba(60, 60, 67, .78);
          --c-text-3: rgba(60, 60, 67, .56);
          --c-border: #c2c2c4;
          --c-divider: #e2e2e3;
        }

        

        :root {
          --c-brand-1: var(--c-indigo-1);
          --c-brand-2: var(--c-indigo-2);
          --c-brand-3: var(--c-indigo-3);
          --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
          --font-family-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
          --code-line-height: 20px;
          --code-font-size: 12px;
          --code-color: var(--c-brand-1);
          --code-bg: var(--c-gray-soft);
          --code-block-bg: var(--c-bg-alt);
          --code-block-color: var(--c-text-1);
          --header-height: 46px;
          --border-radius: 6px;
          --max-content-width: 1470px;
        }

        * {
          box-sizing: border-box;
        }

        body {
          margin: 0;
          padding: 0;
          font-family: var(--font-family), sans-serif;
          font-size: 14px;
          line-height: 1;
          color: var(--c-text-1);
          background-color: var(--c-bg);
          text-rendering: optimizeLegibility;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          -moz-text-size-adjust: none;
          -webkit-text-size-adjust: none;
          text-size-adjust: none;
          min-height: 100vh;
          display: flex;
          flex-direction: column;
        }

        .nowrap {
          white-space: nowrap;
        }

        h1 {
          margin-inline: 0;
          margin-block: 16px;
          font-size: 20px;
          font-weight: 600;
        }

        a {
          color: var(--c-brand-1);
          font-weight: 500;
          text-decoration: underline;
          text-underline-offset: 2px;
          text-decoration: inherit;
          touch-action: manipulation;
        }

        a:hover {
          color: var(--c-brand-2);
          text-decoration: underline;
        }

        .menu {
          background-color: var(--c-bg-alt);
          border-bottom: 1px solid var(--c-divider);
          overflow-x: auto;
        }

        .menu-content {
          display: flex;
          flex-direction: row;
          align-items: center;
          gap: 16px;
          padding-inline: 16px;
          max-width: var(--max-content-width);
          margin-inline: auto;
        }

        .menu-item {
          display: flex;
          align-items: center;
          border-bottom: 2px solid transparent;
          height: 56px;
          padding-inline: 8px;
        }

        .menu-item a {
          display: flex;
          flex-direction: row;
          gap: 8px;
          align-items: center;
          color: var(--c-text-1);
          padding: 8px 10px;
          border-radius: 4px;
        }

        .menu-item a:hover {
          background-color: var(--c-bg-elv);
          text-decoration: none;
        }

        .menu-item.selected {
          border-bottom-color: var(--c-brand-1);
        }

        .project-name {
          font-weight: 600;
          font-size: 16px;
          margin-inline: 16px;
          color: var(--c-text-1);
          text-decoration: none;
        }

        main {
          flex-grow: 1;
          width: 100%;
          max-width: var(--max-content-width);
          margin: 16px auto;
        }

        .main-content {
          padding-inline: 16px;
        }

        footer {
          padding: 12px 16px;
          background-color: var(--c-bg-alt);
          border-top: 1px solid var(--c-divider);
          color: var(--c-text-3);
          font-size: 12px;
          text-align: center;
        }

        .header-container {
          container-type: scroll-state;
          position: sticky;
          top: 0;
        }

        .header-container {
          @container scroll-state(stuck: top) {
            header {
              border-top: none;
              border-top-left-radius: 0;
              border-top-right-radius: 0;
            }

            .goto-top {
              display: flex;
            }
          }
        }

        header {
          display: flex;
          flex-direction: row;
          align-items: center;
          min-height: var(--header-height);
          padding-inline: 16px;
          background: var(--c-bg-alt);
          border: 1px solid var(--c-border);
          border-top-left-radius: var(--border-radius);
          border-top-right-radius: var(--border-radius);
        }

        header h1 {
          word-break: break-all;
          font-weight: 600;
          font-size: 16px;
          margin: 0;
          padding: 0;
        }

        .header-ref {
          color: var(--c-text-2);
          border: 1px solid var(--c-border);
          border-radius: 6px;
          padding: 6px 10px;
          margin-right: 10px;
          margin-left: -6px;
        }

        header .path {
          font-size: 16px;
        }

        .breadcrumbs {
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          gap: 6px;
          font-size: 16px;
        }

        .breadcrumbs a {
          word-break: break-all;
        }

        .goto-top {
          display: none;
          margin-left: auto;
          padding: 6px 10px;
          background: none;
          border: none;
          border-radius: 6px;
          gap: 4px;
          align-items: center;
          color: var(--c-text-1);
          cursor: pointer;
        }

        .goto-top:hover {
          background: var(--c-bg-elv);
        }
    </style>
    
    <style>
      h1 code {
        border-radius: var(--border-radius);
        background: var(--c-bg-alt);
        padding: 4px 8px;
        font-family: var(--font-family-mono), monospace;
        font-weight: 500;
      }

      .commit {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-bottom: 16px;
      }

      .commit-info {
        display: flex;
        flex-direction: row;
        gap: 8px;
        align-items: flex-end;
      }

      .commit-author {
        color: var(--c-text-1);
        font-weight: 600;
        min-width: 0;
        overflow-wrap: break-word;
      }

      .commit-date {
        color: var(--c-text-2);
        font-size: 12px;
        font-family: var(--font-family-mono), monospace;
      }

      .commit-message {
        border: 1px solid var(--c-border);
        border-radius: var(--border-radius);
        padding: 16px;
      }

      .ref-badges {
        display: inline-flex;
        gap: 6px;
        margin-left: 8px;
      }

      .badge {
        font-size: 12px;
        color: var(--c-text-2);
        border: 1px solid var(--c-border);
        padding: 2px 6px;
        border-radius: 999px;
        white-space: nowrap;
      }

      .commit-subject {
        font-size: 16px;
        font-weight: 600;
        line-height: 1.3;
        hyphens: auto;
      }

      .commit-body {
        margin-top: 16px;
        white-space: pre-wrap;
        line-height: 1.5;
        hyphens: auto;
      }

      .commit-subinfo {
        display: flex;
        flex-direction: row;
        gap: 16px;
        justify-content: space-between;
      }

      .commit-layout {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
      }

      @media (min-width: 960px) {
        .commit-layout {
          grid-template-columns: 300px 1fr;
          align-items: start;
        }

        .files-tree {
          position: sticky;
          top: 16px;
        }

        .files-tree-content {
          max-height: calc(100vh - var(--header-height) - 40px);
          overflow: auto;
        }
      }

      .files-tree {
        border: 1px solid var(--c-border);
        border-radius: var(--border-radius);
      }

      .files-tree-header {
        display: flex;
        flex-direction: row;
        align-items: center;
        padding-inline: 16px;
        height: var(--header-height);
        border-bottom: 1px solid var(--c-border);
        border-top-left-radius: var(--border-radius);
        border-top-right-radius: var(--border-radius);
        background: var(--c-bg-alt);
        font-size: 14px;
        font-weight: 600;
      }

      .files-tree-content {
        display: block;
        padding-block: 6px;
      }

      .tree .children {
        margin-left: 16px;
        border-left: 1px dashed var(--c-border);
      }

      .tree .node {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 16px;
      }

      .tree .file-name {
        flex: 1;
        font-weight: 500;
        color: var(--c-text-1);
        cursor: pointer;
      }

      .tree .file-name:hover {
        color: var(--c-brand-2);
        text-decoration: underline;
      }

      .tree .dir {
        color: var(--c-dir);
      }

      .tree .file-added {
        color: var(--c-green);
      }

      .tree .file-deleted {
        color: var(--c-red);
      }

      .tree .file-renamed {
        color: var(--c-yellow);
      }

       

      .files {
        min-width: 0;
      }

      .file-section + .file-section {
        margin-top: 16px;
      }

      pre {
        border: 1px solid var(--c-border);
        border-top: none;
        border-bottom-left-radius: var(--border-radius);
        border-bottom-right-radius: var(--border-radius);
      }

      pre {
        margin: 0;
        padding: 8px 16px;
        overflow-x: auto;
        white-space: pre;
        word-spacing: normal;
        word-break: normal;
        word-wrap: normal;
        tab-size: 4;
        font-family: var(--font-family-mono), monospace;
      }

      pre > code {
        display: block;
        padding: 0 16px;
        width: fit-content;
        min-width: 100%;
        line-height: var(--code-line-height);
        font-size: var(--code-font-size);
      }

      .binary-file {
        padding: 8px 16px;
        font-style: italic;
      }

      .border {
        border: 1px solid var(--c-border);
        border-top: none;
        border-bottom-left-radius: 6px;
        border-bottom-right-radius: 6px;
      }

      .bg { background-color: #ffffff; }
.chroma { background-color: #ffffff; }
.chroma .err { color: #f6f8fa; background-color: #82071e }
.chroma .lnlinks { outline: none; text-decoration: none; color: inherit }
.chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
.chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; }
.chroma .hl { background-color: #e5e5e5 }
.chroma .lnt { white-space: pre; -webkit-user-select: none; user-select: none; margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
.chroma .ln { white-space: pre; -webkit-user-select: none; user-select: none; margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
.chroma .line { display: flex; }
.chroma .k { color: #cf222e }
.chroma .kc { color: #cf222e }
.chroma .kd { color: #cf222e }
.chroma .kn { color: #cf222e }
.chroma .kp { color: #cf222e }
.chroma .kr { color: #cf222e }
.chroma .kt { color: #cf222e }
.chroma .na { color: #1f2328 }
.chroma .nc { color: #1f2328 }
.chroma .no { color: #0550ae }
.chroma .nd { color: #0550ae }
.chroma .ni { color: #6639ba }
.chroma .nl { color: #990000; font-weight: bold }
.chroma .nn { color: #24292e }
.chroma .nx { color: #1f2328 }
.chroma .nt { color: #0550ae }
.chroma .nb { color: #6639ba }
.chroma .bp { color: #6a737d }
.chroma .nv { color: #953800 }
.chroma .vc { color: #953800 }
.chroma .vg { color: #953800 }
.chroma .vi { color: #953800 }
.chroma .vm { color: #953800 }
.chroma .nf { color: #6639ba }
.chroma .fm { color: #6639ba }
.chroma .s { color: #0a3069 }
.chroma .sa { color: #0a3069 }
.chroma .sb { color: #0a3069 }
.chroma .sc { color: #0a3069 }
.chroma .dl { color: #0a3069 }
.chroma .sd { color: #0a3069 }
.chroma .s2 { color: #0a3069 }
.chroma .se { color: #0a3069 }
.chroma .sh { color: #0a3069 }
.chroma .si { color: #0a3069 }
.chroma .sx { color: #0a3069 }
.chroma .sr { color: #0a3069 }
.chroma .s1 { color: #0a3069 }
.chroma .ss { color: #032f62 }
.chroma .m { color: #0550ae }
.chroma .mb { color: #0550ae }
.chroma .mf { color: #0550ae }
.chroma .mh { color: #0550ae }
.chroma .mi { color: #0550ae }
.chroma .il { color: #0550ae }
.chroma .mo { color: #0550ae }
.chroma .o { color: #0550ae }
.chroma .ow { color: #0550ae }
.chroma .p { color: #1f2328 }
.chroma .c { color: #57606a }
.chroma .ch { color: #57606a }
.chroma .cm { color: #57606a }
.chroma .c1 { color: #57606a }
.chroma .cs { color: #57606a }
.chroma .cp { color: #57606a }
.chroma .cpf { color: #57606a }
.chroma .gd { color: #82071e; background-color: #ffebe9;display: block; }
.chroma .ge { color: #1f2328 }
.chroma .gi { color: #116329; background-color: #dafbe1;display: block; }
.chroma .go { color: #1f2328 }
.chroma .gl { text-decoration: underline }
.chroma .w { color: #ffffff }

    </style>

</head>
<body>

    <svg style="display: none" aria-hidden="true" focusable="false">
        <symbol id="dir" viewBox="0 0 16 16">
            <path fill="currentColor"
                  d="M1.75 1A1.75 1.75 0 0 0 0 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0 0 16 13.25v-8.5A1.75 1.75 0 0 0 14.25 3H7.5a.25.25 0 0 1-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75Z"/>
        </symbol>
        <symbol id="file" viewBox="0 0 16 16">
            <path fill="currentColor"
                  d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"/>
        </symbol>
        <symbol id="file-added" viewBox="0 0 16 16">
            <path fill="currentColor"
                  d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V4.664a.25.25 0 0 0-.073-.177l-2.914-2.914a.25.25 0 0 0-.177-.073Zm4.48 3.758a.75.75 0 0 1 .755.745l.01 1.497h1.497a.75.75 0 0 1 0 1.5H9v1.507a.75.75 0 0 1-1.5 0V9.005l-1.502.01a.75.75 0 0 1-.01-1.5l1.507-.01-.01-1.492a.75.75 0 0 1 .745-.755Z"/>
        </symbol>
        <symbol id="file-modified" viewBox="0 0 16 16">
            <path fill="currentColor"
                  d="M1 1.75C1 .784 1.784 0 2.75 0h7.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16H2.75A1.75 1.75 0 0 1 1 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25V4.664a.25.25 0 0 0-.073-.177l-2.914-2.914a.25.25 0 0 0-.177-.073ZM8 3.25a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0V7h-1.5a.75.75 0 0 1 0-1.5h1.5V4A.75.75 0 0 1 8 3.25Zm-3 8a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1-.75-.75Z"/>
        </symbol>
        <symbol id="file-deleted" viewBox="0 0 16 16">
            <path fill="currentColor"
                  d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V4.664a.25.25 0 0 0-.073-.177l-2.914-2.914a.25.25 0 0 0-.177-.073Zm4.5 6h2.242a.75.75 0 0 1 0 1.5h-2.24l-2.254.015a.75.75 0 0 1-.01-1.5Z"/>
        </symbol>
        <symbol id="file-renamed" viewBox="0 0 16 16">
            <path fill="currentColor"
                  d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-3.5a.75.75 0 0 1 0-1.5h3.5a.25.25 0 0 0 .25-.25V4.664a.25.25 0 0 0-.073-.177l-2.914-2.914a.25.25 0 0 0-.177-.073H3.75a.25.25 0 0 0-.25.25v6.5a.75.75 0 0 1-1.5 0v-6.5Z"/>
            <path fill="currentColor"
                  d="m5.427 15.573 3.146-3.146a.25.25 0 0 0 0-.354L5.427 8.927A.25.25 0 0 0 5 9.104V11.5H.75a.75.75 0 0 0 0 1.5H5v2.396c0 .223.27.335.427.177Z"/>
        </symbol>
        <symbol id="arrow-top" viewBox="0 0 16 16">
            <path fill="currentColor"
                  d="M3.47 7.78a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0l4.25 4.25a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018L9 4.81v7.44a.75.75 0 0 1-1.5 0V4.81L4.53 7.78a.75.75 0 0 1-1.06 0Z"></path>
        </symbol>
        <symbol id="commit" viewBox="0 0 16 16">
            <path fill="currentColor"
                  d="M11.93 8.5a4.002 4.002 0 0 1-7.86 0H.75a.75.75 0 0 1 0-1.5h3.32a4.002 4.002 0 0 1 7.86 0h3.32a.75.75 0 0 1 0 1.5Zm-1.43-.75a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z"></path>
        </symbol>
        <symbol id="branch" viewBox="0 0 16 16">
            <path fill="currentColor"
                  d="M9.5 3.25a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.493 2.493 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25Zm-6 0a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0Zm8.25-.75a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Z"></path>
        </symbol>
        <symbol id="tag" viewBox="0 0 16 16">
            <path fill="currentColor"
                  d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"></path>
        </symbol>
        <symbol id="code" viewBox="0 0 16 16">
            <path fill="currentColor"
                  d="m11.28 3.22 4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L13.94 8l-3.72-3.72a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215Zm-6.56 0a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L2.06 8l3.72 3.72a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L.47 8.53a.75.75 0 0 1 0-1.06Z"></path>
        </symbol>
    </svg>

<div class="menu">
    <div class="menu-content">
        <a href="../index.html" class="project-name">personal-web-2025</a>
        <div class="menu-item ">
            <a href="../blob/main/index.html">
                <svg aria-hidden="true" width="16" height="16">
                    <use xlink:href="#code"></use>
                </svg>
                Code
            </a>
        </div>
        <div class="menu-item ">
            <a href="../branches.html">
                <svg aria-hidden="true" focusable="false" width="16" height="16">
                    <use xlink:href="#branch"></use>
                </svg>
                Branches
            </a>
        </div>
        <div class="menu-item ">
            <a href="../tags.html">
                <svg aria-hidden="true" focusable="false" width="16" height="16">
                    <use xlink:href="#tag"></use>
                </svg>
                Tags
            </a>
        </div>
        <div class="menu-item selected">
            <a href="../commits/main/index.html">
                <svg aria-hidden="true" focusable="false" width="16" height="16">
                    <use xlink:href="#commit"></use>
                </svg>
                Commits
            </a>
        </div>
    </div>
</div>
<main>
    <div class="main-content">
        
    <h1>Commit <code>12ffa6e</code></h1>

    <div class="commit">
        <div class="commit-info">
            <div class="commit-author">distilledchild &lt;sliceofmysoul@gmail.com&gt;</div>
            <div class="commit-date"><span class="nowrap">2025-12-02</span> <span class="nowrap">03:59:23</span></div>
        </div>
        <div class="commit-message">
            <div class="commit-subject">
                Research/hicbrowser implement top-left design change cors setting for the loop and genomic data from google cloud bucket
                
            </div>
            
        </div>
        <div class="commit-subinfo">
            <div class="commit-branch">
                
                    <a href="../commits/main/index.html" class="badge">main</a>
                
            </div>
            
                <div class="commit-parents">
                    
                        1 parent
                    
                    
                        
                        <a href="0d7e6c72cf0683ef95cf03d6c2f30bbffd0bdfc9.html"><code>0d7e6c7</code></a>
                    
                </div>
            
        </div>
    </div>

    <div class="commit-layout">
        <div class="files-tree">
            <div class="files-tree-header">Changed files (10)</div>
            <div class="files-tree-content">
                
                    <div class="tree">
                        
    
        
            <details open>
                <summary class="node">
                    <svg aria-hidden="true" focusable="false" width="16" height="16" class="dir">
                        <use xlink:href="#dir"></use>
                    </svg>
                    <span class="file-name">components</span>
                </summary>
                <div class="children">
                    
    
        
            <div class="node">
                <div class="icon" aria-hidden="true">
                    
                        <svg aria-hidden="true" focusable="false" width="16" height="16" class="file-added">
                            <use xlink:href="#file-added"></use>
                        </svg>
                    
                </div>
                <a href="#components%2fGenomeVisualization.tsx" class="file-name">
                    GenomeVisualization.tsx
                </a>
            </div>
        
    
        
            <div class="node">
                <div class="icon" aria-hidden="true">
                    
                        <svg aria-hidden="true" focusable="false" width="16" height="16" class="file-added">
                            <use xlink:href="#file-added"></use>
                        </svg>
                    
                </div>
                <a href="#components%2fGenomeVisualizationEnhanced.tsx" class="file-name">
                    GenomeVisualizationEnhanced.tsx
                </a>
            </div>
        
    
        
            <div class="node">
                <div class="icon" aria-hidden="true">
                    
                        <svg aria-hidden="true" focusable="false" width="16" height="16">
                            <use xlink:href="#file-modified"></use>
                        </svg>
                    
                </div>
                <a href="#components%2fThreeDNA.tsx" class="file-name">
                    ThreeDNA.tsx
                </a>
            </div>
        
    

                </div>
            </details>
        
    
        
            <details open>
                <summary class="node">
                    <svg aria-hidden="true" focusable="false" width="16" height="16" class="dir">
                        <use xlink:href="#dir"></use>
                    </svg>
                    <span class="file-name">pages</span>
                </summary>
                <div class="children">
                    
    
        
            <div class="node">
                <div class="icon" aria-hidden="true">
                    
                        <svg aria-hidden="true" focusable="false" width="16" height="16">
                            <use xlink:href="#file-modified"></use>
                        </svg>
                    
                </div>
                <a href="#pages%2fAbout.tsx" class="file-name">
                    About.tsx
                </a>
            </div>
        
    
        
            <div class="node">
                <div class="icon" aria-hidden="true">
                    
                        <svg aria-hidden="true" focusable="false" width="16" height="16">
                            <use xlink:href="#file-modified"></use>
                        </svg>
                    
                </div>
                <a href="#pages%2fResearch.tsx" class="file-name">
                    Research.tsx
                </a>
            </div>
        
    

                </div>
            </details>
        
    
        
            <details open>
                <summary class="node">
                    <svg aria-hidden="true" focusable="false" width="16" height="16" class="dir">
                        <use xlink:href="#dir"></use>
                    </svg>
                    <span class="file-name">utils</span>
                </summary>
                <div class="children">
                    
    
        
            <div class="node">
                <div class="icon" aria-hidden="true">
                    
                        <svg aria-hidden="true" focusable="false" width="16" height="16" class="file-added">
                            <use xlink:href="#file-added"></use>
                        </svg>
                    
                </div>
                <a href="#utils%2fcsvLoader.ts" class="file-name">
                    csvLoader.ts
                </a>
            </div>
        
    

                </div>
            </details>
        
    
        
            <div class="node">
                <div class="icon" aria-hidden="true">
                    
                        <svg aria-hidden="true" focusable="false" width="16" height="16">
                            <use xlink:href="#file-modified"></use>
                        </svg>
                    
                </div>
                <a href="#.gitignore" class="file-name">
                    .gitignore
                </a>
            </div>
        
    
        
            <div class="node">
                <div class="icon" aria-hidden="true">
                    
                        <svg aria-hidden="true" focusable="false" width="16" height="16">
                            <use xlink:href="#file-modified"></use>
                        </svg>
                    
                </div>
                <a href="#App.tsx" class="file-name">
                    App.tsx
                </a>
            </div>
        
    
        
            <div class="node">
                <div class="icon" aria-hidden="true">
                    
                        <svg aria-hidden="true" focusable="false" width="16" height="16" class="file-added">
                            <use xlink:href="#file-added"></use>
                        </svg>
                    
                </div>
                <a href="#gcs-cors-config.json" class="file-name">
                    gcs-cors-config.json
                </a>
            </div>
        
    
        
            <div class="node">
                <div class="icon" aria-hidden="true">
                    
                        <svg aria-hidden="true" focusable="false" width="16" height="16" class="file-added">
                            <use xlink:href="#file-added"></use>
                        </svg>
                    
                </div>
                <a href="#GENOME_VISUALIZATION_DATA_GUIDE.md" class="file-name">
                    GENOME_VISUALIZATION_DATA_GUIDE.md
                </a>
            </div>
        
    

                    </div>
                
            </div>
        </div>

        <div class="files">
            
                <section id="components/GenomeVisualization.tsx" class="file-section">
                    <div class="header-container">
                        <header class="file-header">
                            
                                <div class="path">components/GenomeVisualization.tsx</div>
                            
                            <button class="goto-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                                <svg aria-hidden="true" focusable="false" width="16" height="16">
                                    <use xlink:href="#arrow-top"></use>
                                </svg>
                                Top
                            </button>
                        </header>
                    </div>
                    
                        <div class="file-diff">
                            <pre class="chroma"><code><span class="line"><span class="cl"><span class="gu">@@ -0,0 +1,488 @@
</span></span></span><span class="line"><span class="cl"><span class="gu"></span><span class="gi">+import React, { useRef, useEffect, useState } from &#39;react&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+import { ZoomIn, ZoomOut, RotateCcw } from &#39;lucide-react&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+import { loadLoopData, loadChromosomeData, loadGeneData, type LoopDataRow, type ChromosomeDataRow, type GeneDataRow } from &#39;../utils/csvLoader&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+interface HoverInfo {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    x: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    y: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    geneName: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    geneId: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    coordinates: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    geneCoordinates: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+export const GenomeVisualization: React.FC = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const containerRef = useRef&lt;HTMLDivElement&gt;(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Visualization state
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [scale, setScale] = useState(1);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [offset, setOffset] = useState(0);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [isDragging, setIsDragging] = useState(false);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [dragStart, setDragStart] = useState({ x: 0, offset: 0 });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [hoverInfo, setHoverInfo] = useState&lt;HoverInfo | null&gt;(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [selectedGene, setSelectedGene] = useState&lt;GeneDataRow | null&gt;(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Data state
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [selectedChr, setSelectedChr] = useState(&#39;chr12&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [loading, setLoading] = useState(true);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [allChromosomes, setAllChromosomes] = useState&lt;ChromosomeDataRow[]&gt;([]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [allLoops, setAllLoops] = useState&lt;LoopDataRow[]&gt;([]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [allGenes, setAllGenes] = useState&lt;GeneDataRow[]&gt;([]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Load data on mount
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    useEffect(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const loadData = async () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            setLoading(true);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const [chromosomes, loops, genes] = await Promise.all([
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    loadChromosomeData(),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    loadLoopData(),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    loadGeneData()
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                setAllChromosomes(chromosomes);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                setAllLoops(loops);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                setAllGenes(genes);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                console.log(&#39;Loaded data:&#39;, {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    chromosomes: chromosomes.length,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    loops: loops.length,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    genes: genes.length
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                console.error(&#39;Failed to load genome data:&#39;, error);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            } finally {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                setLoading(false);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        loadData();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }, []);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Get current chromosome data
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const chromosomeData = allChromosomes.find(c =&gt; c.chr === selectedChr) ||
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        { chr: selectedChr, end: 100000000, start: 0 };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Filter data for selected chromosome
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const loopData = allLoops.filter(l =&gt; l.chr1 === selectedChr &amp;&amp; l.chr2 === selectedChr);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const geneData = allGenes.filter(g =&gt; g.chr === selectedChr);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Get gene coordinates from CSV data fields
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const parseGeneCoordinates = (gene: GeneDataRow) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!gene.gene_start || !gene.gene_end) return null;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            start: gene.gene_start,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            end: gene.gene_end
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Convert genomic coordinate to canvas x position
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const genomicToCanvas = (genomicPos: number, canvasWidth: number) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewStart = offset / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewWidth = chromosomeData.end / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const relativePos = (genomicPos - viewStart) / viewWidth;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return relativePos * canvasWidth;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Convert canvas x position to genomic coordinate
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const canvasToGenomic = (canvasX: number, canvasWidth: number) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewStart = offset / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewWidth = chromosomeData.end / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const relativePos = canvasX / canvasWidth;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return viewStart + (relativePos * viewWidth);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Draw the chromosome
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const drawChromosome = (ctx: CanvasRenderingContext2D, width: number, height: number) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const chromosomeY = height - 100;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const chromosomeHeight = 30;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw chromosome background
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillStyle = &#39;#e2e8f0&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillRect(0, chromosomeY, width, chromosomeHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw chromosome border
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.strokeStyle = &#39;#64748b&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.lineWidth = 2;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.strokeRect(0, chromosomeY, width, chromosomeHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw scale markers
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillStyle = &#39;#475569&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.font = &#39;12px monospace&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewStart = offset / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewWidth = chromosomeData.end / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const markerInterval = Math.pow(10, Math.floor(Math.log10(viewWidth / 10)));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        for (let pos = Math.floor(viewStart / markerInterval) * markerInterval;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            pos &lt;= viewStart + viewWidth;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            pos += markerInterval) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const x = genomicToCanvas(pos, width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            if (x &gt;= 0 &amp;&amp; x &lt;= width) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.moveTo(x, chromosomeY);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.lineTo(x, chromosomeY - 10);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.stroke();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.fillText(
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    `${(pos / 1000000).toFixed(1)}Mb`,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    x - 20,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    chromosomeY - 15
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                );
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw chromosome label
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillStyle = &#39;#1e293b&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.font = &#39;bold 16px sans-serif&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillText(chromosomeData.chr, 10, chromosomeY + chromosomeHeight / 2 + 5);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Draw loops as parabolic arcs
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const drawLoops = (ctx: CanvasRenderingContext2D, width: number, height: number) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const chromosomeY = height - 100;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.strokeStyle = &#39;#3b82f6&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.lineWidth = 1.5;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.globalAlpha = 0.7;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        loopData.forEach(loop =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const x1 = genomicToCanvas((loop.x1 + loop.x2) / 2, width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const x2 = genomicToCanvas((loop.y1 + loop.y2) / 2, width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            if ((x1 &gt;= 0 &amp;&amp; x1 &lt;= width) || (x2 &gt;= 0 &amp;&amp; x2 &lt;= width)) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const arcHeight = Math.min(Math.abs(x2 - x1) * 0.3, 200);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.moveTo(x1, chromosomeY);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Draw parabolic arc using quadratic curve
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const controlX = (x1 + x2) / 2;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const controlY = chromosomeY - arcHeight;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.quadraticCurveTo(controlX, controlY, x2, chromosomeY);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.stroke();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.globalAlpha = 1;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Draw TSS/Promoters and gene connections
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const drawGenes = (ctx: CanvasRenderingContext2D, width: number, height: number, mousePos: { x: number; y: number } | null) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const chromosomeY = height - 100;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const markerHeight = 40;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        geneData.forEach(gene =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const geneX = genomicToCanvas(gene.start, width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            if (geneX &gt;= 0 &amp;&amp; geneX &lt;= width) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Determine color based on component type
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const color = gene.component === &#39;tss&#39; ? &#39;#ec4899&#39; : &#39;#8b5cf6&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Check if mouse is hovering over this gene
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const isHovering = mousePos &amp;&amp;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    Math.abs(mousePos.x - geneX) &lt; 5 &amp;&amp;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    mousePos.y &gt; chromosomeY - markerHeight - 10 &amp;&amp;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    mousePos.y &lt; chromosomeY + 30;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Draw marker line
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.strokeStyle = color;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.lineWidth = isHovering ? 3 : 2;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.moveTo(geneX, chromosomeY - markerHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.lineTo(geneX, chromosomeY + 30);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.stroke();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Draw marker circle
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.fillStyle = color;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.arc(geneX, chromosomeY - markerHeight, isHovering ? 6 : 4, 0, Math.PI * 2);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.fill();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // If hovering or selected, draw connection to gene
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                if (isHovering || (selectedGene &amp;&amp; selectedGene.gene_id === gene.gene_id)) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    const geneCoords = parseGeneCoordinates(gene);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    if (geneCoords) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        const geneMidX = genomicToCanvas((geneCoords.start + geneCoords.end) / 2, width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        // Draw parabolic connection
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.strokeStyle = color;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.lineWidth = 1;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.globalAlpha = 0.4;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.setLineDash([5, 5]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.moveTo(geneX, chromosomeY - markerHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        const arcHeight = Math.min(Math.abs(geneMidX - geneX) * 0.2, 100);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        const controlX = (geneX + geneMidX) / 2;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        const controlY = chromosomeY - markerHeight - arcHeight;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.quadraticCurveTo(controlX, controlY, geneMidX, chromosomeY - markerHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.stroke();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.setLineDash([]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.globalAlpha = 1;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        // Draw gene marker
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.fillStyle = color;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.globalAlpha = 0.5;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.arc(geneMidX, chromosomeY - markerHeight, 5, 0, Math.PI * 2);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.fill();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ctx.globalAlpha = 1;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    // Show hover info
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    if (isHovering) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        const geneCoords = parseGeneCoordinates(gene);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        setHoverInfo({
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            x: mousePos.x,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            y: mousePos.y,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            geneName: gene.gene_name,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            geneId: gene.gene_id,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            coordinates: `${gene.chr}:${gene.start.toLocaleString()}-${gene.end.toLocaleString()}`,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            geneCoordinates: geneCoords
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                ? `${gene.gene_chr}:${geneCoords.start.toLocaleString()}-${geneCoords.end.toLocaleString()}`
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                : &#39;N/A&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Main draw function
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const draw = (mousePos: { x: number; y: number } | null = null) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const canvas = canvasRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const container = containerRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!canvas || !container) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const ctx = canvas.getContext(&#39;2d&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!ctx) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const width = container.clientWidth;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const height = container.clientHeight;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Set canvas size
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        canvas.width = width;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        canvas.height = height;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Clear canvas
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.clearRect(0, 0, width, height);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw all elements
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        drawChromosome(ctx, width, height);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        drawLoops(ctx, width, height);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        drawGenes(ctx, width, height, mousePos);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Handle zoom
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleZoom = (delta: number, centerX?: number) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const canvas = canvasRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!canvas) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const newScale = Math.max(1, Math.min(1000, scale * (1 + delta)));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Zoom towards center point if provided (for scroll zoom)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (centerX !== undefined) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const genomicCenter = canvasToGenomic(centerX, canvas.width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const newOffset = genomicCenter * newScale - centerX * (chromosomeData.end / canvas.width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            setOffset(Math.max(0, Math.min(chromosomeData.end * (newScale - 1), newOffset)));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setScale(newScale);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Handle mouse events
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleMouseDown = (e: React.MouseEvent&lt;HTMLCanvasElement&gt;) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setIsDragging(true);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setDragStart({ x: e.clientX, offset });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleMouseMove = (e: React.MouseEvent&lt;HTMLCanvasElement&gt;) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const canvas = canvasRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!canvas) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const rect = canvas.getBoundingClientRect();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const mouseX = e.clientX - rect.left;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const mouseY = e.clientY - rect.top;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (isDragging) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const dx = e.clientX - dragStart.x;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const genomicDx = (dx / canvas.width) * (chromosomeData.end / scale);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const newOffset = Math.max(0, Math.min(
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                chromosomeData.end * (scale - 1) / scale,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                dragStart.offset - genomicDx * scale
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            ));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            setOffset(newOffset);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        } else {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            draw({ x: mouseX, y: mouseY });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleMouseUp = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setIsDragging(false);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleMouseLeave = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setIsDragging(false);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setHoverInfo(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        draw();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleWheel = (e: React.WheelEvent&lt;HTMLCanvasElement&gt;) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        e.preventDefault();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const canvas = canvasRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!canvas) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const rect = canvas.getBoundingClientRect();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const mouseX = e.clientX - rect.left;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const delta = e.deltaY &gt; 0 ? -0.1 : 0.1;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        handleZoom(delta, mouseX);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleReset = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setScale(1);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setOffset(0);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setSelectedGene(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleChrChange = (chr: string) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setSelectedChr(chr);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setScale(1);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setOffset(0);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setSelectedGene(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Redraw when state changes
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    useEffect(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!loading) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            draw();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }, [scale, offset, selectedGene, loading, selectedChr, allLoops, allGenes]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    if (loading) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return (
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;div className=&#34;w-full h-full flex flex-col bg-white rounded-2xl border border-slate-200 overflow-hidden&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;div className=&#34;flex items-center justify-center h-full&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;div className=&#34;text-center&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;div className=&#34;text-lg text-slate-700 font-semibold mb-2&#34;&gt;Loading genome data...&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;div className=&#34;text-sm text-slate-500&#34;&gt;Please wait while we load chromosome, loop, and gene information&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        );
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    return (
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        &lt;div className=&#34;w-full h-full flex flex-col bg-white rounded-2xl border border-slate-200 overflow-hidden&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            {/* Header */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;div className=&#34;px-6 py-4 border-b border-slate-200 bg-slate-50&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;h3 className=&#34;text-xl font-bold text-slate-900&#34;&gt;Genome Browser - {chromosomeData.chr}&lt;/h3&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;p className=&#34;text-sm text-slate-600 mt-1&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    Chromatin loops ({loopData.length}), TSS/Promoters ({geneData.length}), and gene locations
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            {/* Controls */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;div className=&#34;px-6 py-3 border-b border-slate-200 flex items-center gap-4 flex-wrap&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                {/* Chromosome Selector */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;select
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    value={selectedChr}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onChange={(e) =&gt; handleChrChange(e.target.value)}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    className=&#34;px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    title=&#34;Select chromosome&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    {allChromosomes.map(chr =&gt; (
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;option key={chr.chr} value={chr.chr}&gt;{chr.chr}&lt;/option&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ))}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/select&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;div className=&#34;border-l border-slate-300 h-8&#34;&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;button
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onClick={() =&gt; handleZoom(0.2)}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    className=&#34;px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    title=&#34;Zoom In&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;ZoomIn size={18} /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    Zoom In
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/button&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;button
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onClick={() =&gt; handleZoom(-0.2)}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    className=&#34;px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    title=&#34;Zoom Out&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;ZoomOut size={18} /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    Zoom Out
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/button&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;button
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onClick={handleReset}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    className=&#34;px-4 py-2 bg-slate-500 text-white rounded-lg hover:bg-slate-600 transition-colors flex items-center gap-2&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    title=&#34;Reset View&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;RotateCcw size={18} /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    Reset
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/button&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;div className=&#34;ml-auto text-sm text-slate-600&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    Scale: {scale.toFixed(1)}x
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            {/* Canvas Container */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;div className=&#34;flex-1 relative&#34; ref={containerRef}&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;canvas
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ref={canvasRef}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onMouseDown={handleMouseDown}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onMouseMove={handleMouseMove}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onMouseUp={handleMouseUp}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onMouseLeave={handleMouseLeave}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onWheel={handleWheel}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    className=&#34;cursor-grab active:cursor-grabbing w-full h-full&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                {/* Hover tooltip */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                {hoverInfo &amp;&amp; (
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;div
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        className=&#34;absolute bg-slate-900 text-white px-4 py-3 rounded-lg shadow-xl pointer-events-none z-10 text-sm&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        style={{
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            left: `${hoverInfo.x + 15}px`,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            top: `${hoverInfo.y - 80}px`,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            maxWidth: &#39;300px&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        }}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;div className=&#34;font-bold mb-1&#34;&gt;{hoverInfo.geneName}&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;div className=&#34;text-slate-300 text-xs space-y-1&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &lt;div&gt;ID: {hoverInfo.geneId}&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &lt;div&gt;TSS/Pro: {hoverInfo.coordinates}&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &lt;div&gt;Gene: {hoverInfo.geneCoordinates}&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                )}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            {/* Legend */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;div className=&#34;px-6 py-3 border-t border-slate-200 bg-slate-50 flex items-center gap-6 text-sm&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;div className=&#34;flex items-center gap-2&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;div className=&#34;w-4 h-4 rounded-full bg-pink-500&#34;&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;span className=&#34;text-slate-700&#34;&gt;TSS&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;div className=&#34;flex items-center gap-2&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;div className=&#34;w-4 h-4 rounded-full bg-purple-500&#34;&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;span className=&#34;text-slate-700&#34;&gt;Promoter&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;div className=&#34;flex items-center gap-2&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;div className=&#34;w-12 h-0.5 bg-blue-500&#34;&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;span className=&#34;text-slate-700&#34;&gt;Chromatin Loop&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;div className=&#34;flex items-center gap-2&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;div className=&#34;w-12 h-0.5 border-t-2 border-dashed border-slate-400&#34;&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;span className=&#34;text-slate-700&#34;&gt;TSS/Pro to Gene&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    );
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+};
</span></span></span></code></pre>
                        </div>
                    
                </section>
            
                <section id="components/GenomeVisualizationEnhanced.tsx" class="file-section">
                    <div class="header-container">
                        <header class="file-header">
                            
                                <div class="path">components/GenomeVisualizationEnhanced.tsx</div>
                            
                            <button class="goto-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                                <svg aria-hidden="true" focusable="false" width="16" height="16">
                                    <use xlink:href="#arrow-top"></use>
                                </svg>
                                Top
                            </button>
                        </header>
                    </div>
                    
                        <div class="file-diff">
                            <pre class="chroma"><code><span class="line"><span class="cl"><span class="gu">@@ -0,0 +1,745 @@
</span></span></span><span class="line"><span class="cl"><span class="gu"></span><span class="gi">+import React, { useRef, useEffect, useState } from &#39;react&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+import { ZoomIn, ZoomOut, RotateCcw } from &#39;lucide-react&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+import { loadChromosomeData, loadLoopDataForChr, loadGeneDataForChr, prefetchAllChromosomes, type LoopDataRow, type ChromosomeDataRow, type GeneDataRow } from &#39;../utils/csvLoader&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+interface HoverInfo {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    x: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    y: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    geneName: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    geneId: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    coordinates: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    component: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+export const GenomeVisualizationEnhanced: React.FC = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const containerRef = useRef&lt;HTMLDivElement&gt;(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Visualization state
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [scale, setScale] = useState(1.0);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [offset, setOffset] = useState(0);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [isDragging, setIsDragging] = useState(false);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [dragStart, setDragStart] = useState({ x: 0, offset: 0 });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [hoverInfo, setHoverInfo] = useState&lt;HoverInfo | null&gt;(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [selectedGene, setSelectedGene] = useState&lt;GeneDataRow | null&gt;(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Data loading state
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [selectedChr, setSelectedChr] = useState(&#39;chr1&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [showLoops, setShowLoops] = useState(true);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [showTSS, setShowTSS] = useState(true);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [showPromoters, setShowPromoters] = useState(true);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [resizeTrigger, setResizeTrigger] = useState(0);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [loading, setLoading] = useState(true);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Data state
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [allChromosomes, setAllChromosomes] = useState&lt;ChromosomeDataRow[]&gt;([]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [allLoops, setAllLoops] = useState&lt;LoopDataRow[]&gt;([]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const [allGenes, setAllGenes] = useState&lt;GeneDataRow[]&gt;([]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Load data on mount and when chromosome changes
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    useEffect(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const loadData = async () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            setLoading(true);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const [chromosomes, loops, genes] = await Promise.all([
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    loadChromosomeData(),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    loadLoopDataForChr(selectedChr),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    loadGeneDataForChr(selectedChr)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                setAllChromosomes(chromosomes);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                setAllLoops(loops);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                setAllGenes(genes);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                console.log(`Loaded data for ${selectedChr}: `, {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    chromosomes: chromosomes.length,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    loops: loops.length,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    genes: genes.length
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // After initial load, start prefetching other chromosomes in background
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                if (chromosomes.length &gt; 0) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    const otherChrs = chromosomes
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        .map(c =&gt; c.chr)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        .filter(c =&gt; c !== selectedChr);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    // Fire and forget - don&#39;t await
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    prefetchAllChromosomes(otherChrs);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                console.error(&#39;Failed to load genome data:&#39;, error);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            } finally {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                setLoading(false);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        loadData();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }, [selectedChr]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Get current chromosome data
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const chromosomeData = allChromosomes.find(c =&gt; c.chr === selectedChr) ||
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        { chr: selectedChr, end: 260522016, start: 0 };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Filter genes based on component type
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const geneData = allGenes.filter(g =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (g.component === &#39;tss&#39;) return showTSS;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (g.component.includes(&#39;pro&#39;)) return showPromoters;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return true;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Filter loops (only show loops where both anchors are on the same chromosome)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const loopData = showLoops ? allLoops.filter(l =&gt; l.chr1 === selectedChr &amp;&amp; l.chr2 === selectedChr) : [];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Parse exon coordinates from the exon_id string
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const parseExonCoordinates = (gene: GeneDataRow) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const exonId = gene.ensembl_exon_id || gene.refseq_exon_id;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!exonId || exonId === &#39;NA&#39;) return null;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const parts = exonId.split(&#39;:&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (parts.length &lt; 3) return null;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            start: parseInt(parts[1]),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            end: parseInt(parts[2])
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Convert genomic coordinate to canvas x position
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const genomicToCanvas = (genomicPos: number, canvasWidth: number) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewStart = offset / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewWidth = chromosomeData.end / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const relativePos = (genomicPos - viewStart) / viewWidth;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return relativePos * canvasWidth;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Convert canvas x position to genomic coordinate
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const canvasToGenomic = (canvasX: number, canvasWidth: number) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewStart = offset / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewWidth = chromosomeData.end / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const relativePos = canvasX / canvasWidth;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return viewStart + (relativePos * viewWidth);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Draw the chromosome
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const drawChromosome = (ctx: CanvasRenderingContext2D, width: number, height: number) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const chromosomeY = height - 60;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const chromosomeHeight = 30;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw chromosome background
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillStyle = &#39;#e2e8f0&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillRect(0, chromosomeY, width, chromosomeHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw chromosome border
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.strokeStyle = &#39;#64748b&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.lineWidth = 2;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.strokeRect(0, chromosomeY, width, chromosomeHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw position markers
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillStyle = &#39;#64748b&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.font = &#39;10px sans-serif&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewStart = offset / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewWidth = chromosomeData.end / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const markerInterval = Math.pow(10, Math.floor(Math.log10(viewWidth / 10)));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        for (let pos = Math.floor(viewStart / markerInterval) * markerInterval;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            pos &lt;= viewStart + viewWidth;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            pos += markerInterval) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const x = genomicToCanvas(pos, width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            if (x &gt;= 0 &amp;&amp; x &lt;= width) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.moveTo(x, chromosomeY);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.lineTo(x, chromosomeY - 10);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.stroke();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.fillText(
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    `${(pos / 1000000).toFixed(1)} Mb`,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    x - 20,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    chromosomeY - 15
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                );
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw chromosome label
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillStyle = &#39;#1e293b&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.font = &#39;bold 16px sans-serif&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillText(chromosomeData.chr, 10, chromosomeY + chromosomeHeight / 2 + 5);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Draw loops as parabolic arcs
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const drawLoops = (ctx: CanvasRenderingContext2D, width: number, height: number) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const chromosomeY = height - 60;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const markerHeight = 40;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        loopData.forEach(loop =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const x1 = genomicToCanvas((loop.x1 + loop.x2) / 2, width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const x2 = genomicToCanvas((loop.y1 + loop.y2) / 2, width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            // console.log(&#34;Loop resolution raw value::::::::::::::::::::&#34;, loop.resolution);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            // console.log(&#34;Resolution after parsing::::::::::::::::::::&#34;, loop.resolution);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            // Check if loop is visible (overlaps with canvas width)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            // Even if anchors are off-screen, the arc might be crossing the screen
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            // Add a buffer to prevent loops from disappearing abruptly when anchors are just off-screen
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const buffer = 200;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            if (Math.min(x1, x2) &lt; width + buffer &amp;&amp; Math.max(x1, x2) &gt; -buffer) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Color based on resolution (teal gradient matching legend)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                let loopColor = &#39;#94a3b8&#39;; // default gray
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const res = loop.resolution?.toString().trim().toUpperCase();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                if (res === &#39;5&#39;) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    loopColor = &#39;#0f766e&#39;; // teal-700, #0d9488&#39;; // teal-600
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                } else if (res === &#39;10&#39;) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    loopColor = &#39;#14b8a6&#39;; // teal-500
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                } else if (res === &#39;25&#39;) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    loopColor = &#39;#99f6e4&#39;; // teal-200, #5eead4// teal-300
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // console.log(&#34;Assigned loopColor:::::::::::::::::::&#34;, loopColor);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Arc height is now 6x marker height (1.5x of previous 4x)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const arcHeight = markerHeight * 6;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Draw parabolic arc
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.strokeStyle = loopColor;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.lineWidth = 1.5;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.globalAlpha = 0.7;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.moveTo(x1, chromosomeY);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const controlX = (x1 + x2) / 2;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const controlY = chromosomeY - arcHeight;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.quadraticCurveTo(controlX, controlY, x2, chromosomeY);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.stroke();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.globalAlpha = 1;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Draw anchor circles at loop ends
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const anchorRadius = 4;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.fillStyle = loopColor;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Left anchor
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.arc(x1, chromosomeY, anchorRadius, 0, Math.PI * 2);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.fill();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Right anchor
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.arc(x2, chromosomeY, anchorRadius, 0, Math.PI * 2);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.fill();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Draw TSS/Promoters and gene connections
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const drawGenes = (ctx: CanvasRenderingContext2D, width: number, height: number, mousePos: { x: number; y: number } | null) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const chromosomeY = height - 60;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const markerHeight = 40;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        let anyHovered = false;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        geneData.forEach(gene =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const geneX = genomicToCanvas(gene.start, width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            if (geneX &gt;= 0 &amp;&amp; geneX &lt;= width) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Determine color based on component type
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const color = gene.component === &#39;tss&#39; ? &#39;#ec4899&#39; : &#39;#8b5cf6&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Check if mouse is hovering over this gene
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const isHovering = mousePos &amp;&amp;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    Math.abs(mousePos.x - geneX) &lt; 5 &amp;&amp;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    mousePos.y &gt; chromosomeY - markerHeight - 10 &amp;&amp;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    mousePos.y &lt; chromosomeY + 30;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                if (isHovering) anyHovered = true;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Draw marker line (matchstick style)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.strokeStyle = color;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.lineWidth = isHovering ? 3 : 2;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.moveTo(geneX, chromosomeY - markerHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.lineTo(geneX, chromosomeY + 30);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.stroke();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Draw marker circle head
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.fillStyle = color;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.arc(geneX, chromosomeY - markerHeight, isHovering ? 6 : 4, 0, Math.PI * 2);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ctx.fill();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Check if gene info exists (gene_chr, gene_start, gene_end)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                const hasGeneInfo = gene.gene_chr &amp;&amp; gene.gene_start &amp;&amp; gene.gene_end &amp;&amp;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    gene.gene_start !== gene.start; // Make sure it&#39;s different from TSS/Promoter
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Draw connection to gene if gene info exists
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                if (hasGeneInfo) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    const geneMidX = genomicToCanvas((gene.gene_start + gene.gene_end) / 2, width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    // Draw parabolic connection
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.strokeStyle = color;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.lineWidth = 1;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.globalAlpha = 0.4;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.setLineDash([5, 5]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.moveTo(geneX, chromosomeY - markerHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    const arcHeight = Math.min(Math.abs(geneMidX - geneX) * 0.2, 100);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    const controlX = (geneX + geneMidX) / 2;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    const controlY = chromosomeY - markerHeight - arcHeight;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.quadraticCurveTo(controlX, controlY, geneMidX, chromosomeY - markerHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.stroke();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.setLineDash([]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.globalAlpha = 1;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    // Draw gene marker (different shape - diamond/rhombus)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.fillStyle = color;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.globalAlpha = 0.5;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    const geneMarkerSize = 6;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    // Draw diamond shape
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.beginPath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.moveTo(geneMidX, chromosomeY - markerHeight - geneMarkerSize); // top
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.lineTo(geneMidX + geneMarkerSize, chromosomeY - markerHeight); // right
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.lineTo(geneMidX, chromosomeY - markerHeight + geneMarkerSize); // bottom
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.lineTo(geneMidX - geneMarkerSize, chromosomeY - markerHeight); // left
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.closePath();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.fill();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ctx.globalAlpha = 1;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                // Show hover info
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                if (isHovering &amp;&amp; mousePos) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    // Parse gene_id to get 4th and 5th elements
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    const geneIdParts = gene.gene_id.split(&#39;:&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    const element4 = geneIdParts[3] || &#39;N/A&#39;;  // 4th element (index 3)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    const element5 = geneIdParts[4] || &#39;N/A&#39;;  // 5th element (index 4)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    setHoverInfo({
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        x: mousePos.x,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        y: mousePos.y,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        geneName: element4,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        geneId: element5,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        coordinates: `${gene.chr}:${gene.start}-${gene.end}`,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        component: gene.component
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (mousePos &amp;&amp; !anyHovered) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            setHoverInfo(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Draw the overview bar (minimap)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const drawOverview = (ctx: CanvasRenderingContext2D, width: number, height: number) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const overviewHeight = 15; // Half of main bar height (30)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Place it between main bar (ends at height-30) and bottom (height)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Main bar is at height-60 to height-30.
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // We have 30px space below. Let&#39;s center it roughly.
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const overviewY = height - 22;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw overview background (same color as main bar)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillStyle = &#39;#e2e8f0&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillRect(0, overviewY, width, overviewHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw overview border
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.strokeStyle = &#39;#64748b&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.lineWidth = 1;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.strokeRect(0, overviewY, width, overviewHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw viewport rectangle
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Calculate visible range in genomic coordinates
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewStart = offset / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewWidth = chromosomeData.end / scale;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const viewEnd = viewStart + viewWidth;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Map to canvas coordinates on the overview bar (which is 1x scale, full width)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // overviewX = (genomicPos / chromosomeData.end) * width
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Ensure we don&#39;t divide by zero
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const totalLength = chromosomeData.end || 1;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const x1 = (viewStart / totalLength) * width;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const x2 = (viewEnd / totalLength) * width;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Clamp to canvas bounds for safety
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const rectX = Math.max(0, x1);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const rectW = Math.min(width, x2) - rectX;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw the viewport indicator
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // User requested a rectangle marking the left and right coordinates
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.strokeStyle = &#39;#60a5fa&#39;; // Lighter blue (blue-400) // ctx.strokeStyle = &#39;#14b8a6&#39;; // Teal (teal-500)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.lineWidth = 2;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.strokeRect(rectX, overviewY, rectW, overviewHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Add a semi-transparent fill to highlight the active area
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillStyle = &#39;rgba(96, 165, 250, 0.2)&#39;; // ctx.fillStyle = &#39;rgba(20, 184, 166, 0.2)&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.fillRect(rectX, overviewY, rectW, overviewHeight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Main draw function
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const draw = (mousePos: { x: number; y: number } | null = null) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const canvas = canvasRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const container = containerRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!canvas || !container) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const ctx = canvas.getContext(&#39;2d&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!ctx) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Calculate dimensions accounting for padding
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const style = window.getComputedStyle(container);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const paddingLeft = parseFloat(style.paddingLeft);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const paddingRight = parseFloat(style.paddingRight);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const paddingTop = parseFloat(style.paddingTop);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const paddingBottom = parseFloat(style.paddingBottom);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const width = container.clientWidth - paddingLeft - paddingRight;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const height = container.clientHeight - paddingTop - paddingBottom;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Set canvas size
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        canvas.width = width;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        canvas.height = height;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Clear canvas
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ctx.clearRect(0, 0, width, height);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Draw all elements
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        drawChromosome(ctx, width, height);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        drawOverview(ctx, width, height); // Add overview bar
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (showLoops) drawLoops(ctx, width, height);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (showTSS || showPromoters) drawGenes(ctx, width, height, mousePos);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Handle zoom
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleZoom = (delta: number, centerX?: number) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const canvas = canvasRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!canvas) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Clamp minimum scale to 1.0 to prevent zooming out beyond full chromosome view
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const newScale = Math.max(1.0, Math.min(1000, scale * (1 + delta)));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Zoom towards center point if provided (for scroll zoom)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (centerX !== undefined) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const genomicCenter = canvasToGenomic(centerX, canvas.width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const newOffset = genomicCenter * newScale - centerX * (chromosomeData.end / canvas.width);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            setOffset(Math.max(0, Math.min(chromosomeData.end * (newScale - 1), newOffset)));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setScale(newScale);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Handle wheel event (zoom) with non-passive listener to prevent page scroll
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    useEffect(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const canvas = canvasRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!canvas) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const onWheel = (e: WheelEvent) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            e.preventDefault();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const rect = canvas.getBoundingClientRect();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const mouseX = e.clientX - rect.left;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const delta = e.deltaY &gt; 0 ? -0.1 : 0.1;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            handleZoom(delta, mouseX);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        canvas.addEventListener(&#39;wheel&#39;, onWheel, { passive: false });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            canvas.removeEventListener(&#39;wheel&#39;, onWheel);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }, [scale, offset, chromosomeData]); // Re-bind if dependencies change, or use refs for state
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Refs for drag state and current values to avoid closure staleness in event listeners
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const dragInfoRef = useRef({ startX: 0, startOffset: 0 });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const stateRef = useRef({ scale, chromosomeData });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Update state ref whenever relevant state changes
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    useEffect(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        stateRef.current = { scale, chromosomeData };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }, [scale, chromosomeData]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Handle global mouse events for dragging
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    useEffect(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!isDragging) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const handleGlobalMouseMove = (e: MouseEvent) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const canvas = canvasRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            if (!canvas) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const { scale, chromosomeData } = stateRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const dx = e.clientX - dragInfoRef.current.startX;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            // Calculate new offset based on drag distance
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            // genomicDx * scale = (dx / width) * chromosomeData.end
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const offsetChange = (dx / canvas.width) * chromosomeData.end;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            let newOffset = dragInfoRef.current.startOffset - offsetChange;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            // Clamp offset
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const maxOffset = Math.max(0, chromosomeData.end * (scale - 1));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            newOffset = Math.max(0, Math.min(maxOffset, newOffset));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            setOffset(newOffset);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const handleGlobalMouseUp = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            setIsDragging(false);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        window.addEventListener(&#39;mousemove&#39;, handleGlobalMouseMove);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        window.addEventListener(&#39;mouseup&#39;, handleGlobalMouseUp);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            window.removeEventListener(&#39;mousemove&#39;, handleGlobalMouseMove);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            window.removeEventListener(&#39;mouseup&#39;, handleGlobalMouseUp);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }, [isDragging]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Handle mouse events
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleMouseDown = (e: React.MouseEvent&lt;HTMLCanvasElement&gt;) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setIsDragging(true);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        dragInfoRef.current = {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            startX: e.clientX,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            startOffset: offset
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleMouseMove = (e: React.MouseEvent&lt;HTMLCanvasElement&gt;) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const canvas = canvasRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!canvas) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const rect = canvas.getBoundingClientRect();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const mouseX = e.clientX - rect.left;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const mouseY = e.clientY - rect.top;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Only handle hover effects here. Dragging is handled by global listener.
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!isDragging) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            draw({ x: mouseX, y: mouseY });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleMouseUp = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setIsDragging(false);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleMouseLeave = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Do NOT stop dragging here. Dragging should continue even if mouse leaves canvas.
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setHoverInfo(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        draw();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Removed handleWheel from here as it&#39;s now handled by the effect
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleReset = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setScale(1.0);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setOffset(0);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setSelectedGene(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const handleChrChange = (chr: string) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setSelectedChr(chr);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setScale(1.0);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setOffset(0);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setSelectedGene(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Handle resize
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    useEffect(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const container = containerRef.current;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!container) return;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const resizeObserver = new ResizeObserver(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            setResizeTrigger(prev =&gt; prev + 1);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        resizeObserver.observe(container);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            resizeObserver.disconnect();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }, []);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Redraw when state changes
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    useEffect(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        draw();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }, [scale, offset, selectedGene, selectedChr, showLoops, showTSS, showPromoters, resizeTrigger]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    return (
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        &lt;div className=&#34;w-full h-full flex flex-col bg-white rounded-2xl border border-slate-200 overflow-hidden&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            {/* Controls */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;div className=&#34;px-4 py-2 border-b border-slate-200 flex items-center gap-4 flex-wrap bg-slate-50 flex-shrink-0&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                {/* Chromosome Selector */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;select
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    value={selectedChr}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onChange={(e) =&gt; handleChrChange(e.target.value)}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    className=&#34;px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    title=&#34;Select chromosome&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    disabled={loading}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    {allChromosomes.length &gt; 0 ? (
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        allChromosomes.map(chr =&gt; (
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &lt;option key={chr.chr} value={chr.chr}&gt;{chr.chr}&lt;/option&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        ))
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    ) : (
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;option value={selectedChr}&gt;{selectedChr} (Loading...)&lt;/option&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    )}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/select&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                {/* Feature Toggles */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;label className=&#34;flex items-center gap-2 cursor-pointer&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;input
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        type=&#34;checkbox&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        checked={showLoops}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        onChange={(e) =&gt; setShowLoops(e.target.checked)}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        className=&#34;w-4 h-4&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;span className=&#34;text-sm text-slate-700&#34;&gt;Loops&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/label&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;label className=&#34;flex items-center gap-2 cursor-pointer&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;input
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        type=&#34;checkbox&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        checked={showTSS}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        onChange={(e) =&gt; setShowTSS(e.target.checked)}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        className=&#34;w-4 h-4&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;span className=&#34;text-sm text-slate-700&#34;&gt;TSS&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/label&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;label className=&#34;flex items-center gap-2 cursor-pointer&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;input
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        type=&#34;checkbox&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        checked={showPromoters}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        onChange={(e) =&gt; setShowPromoters(e.target.checked)}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        className=&#34;w-4 h-4&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;span className=&#34;text-sm text-slate-700&#34;&gt;Promoters&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/label&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;div className=&#34;border-l border-slate-300 h-8 mx-2&#34;&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                {/* Zoom Controls */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;button
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onClick={() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        if (canvasRef.current) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            handleZoom(0.2, canvasRef.current.width / 2);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    }}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    className=&#34;px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    title=&#34;Zoom In&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;ZoomIn size={18} /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    Zoom In
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/button&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;button
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onClick={() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        if (canvasRef.current) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            handleZoom(-0.2, canvasRef.current.width / 2);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    }}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    className=&#34;px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    title=&#34;Zoom Out&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;ZoomOut size={18} /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    Zoom Out
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/button&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;button
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    onClick={handleReset}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    className=&#34;px-4 py-2 bg-slate-500 text-white rounded-lg hover:bg-slate-600 transition-colors flex items-center gap-2&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    title=&#34;Reset View&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;RotateCcw size={18} /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    Reset
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/button&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;div className=&#34;ml-auto text-sm text-slate-600&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    Scale: {scale.toFixed(1)}x
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            {/* Canvas Container */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;div className=&#34;flex-1 relative p-6 overflow-hidden&#34; ref={containerRef}&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                {loading ? (
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;div className=&#34;absolute inset-0 flex items-center justify-center bg-slate-50&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;div className=&#34;text-slate-600 font-medium&#34;&gt;Loading genome data for {selectedChr}...&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                ) : (
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;canvas
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            ref={canvasRef}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            onMouseDown={handleMouseDown}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            onMouseMove={handleMouseMove}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            onMouseUp={handleMouseUp}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            onMouseLeave={handleMouseLeave}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            className=&#34;cursor-grab active:cursor-grabbing w-full h-full&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        {/* Top-left legend - Component types */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;div className=&#34;absolute top-4 left-4 bg-white/90 backdrop-blur-sm p-3 rounded-lg shadow-md border border-slate-200 text-xs&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &lt;div className=&#34;font-bold text-slate-700 mb-2&#34;&gt;Components&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &lt;div className=&#34;space-y-1.5&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;div className=&#34;flex items-center gap-2&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;div className=&#34;w-3 h-3 rounded-full bg-pink-500&#34;&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;span className=&#34;text-slate-600&#34;&gt;TSS&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;div className=&#34;flex items-center gap-2&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;div className=&#34;w-3 h-3 rounded-full bg-purple-600&#34;&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;span className=&#34;text-slate-600&#34;&gt;Promoter&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;div className=&#34;flex items-center gap-2&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;div className=&#34;w-3 h-3 bg-pink-500&#34; style={{ clipPath: &#39;polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)&#39; }}&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;span className=&#34;text-slate-600&#34;&gt;TSS Gene&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;div className=&#34;flex items-center gap-2&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;div className=&#34;w-3 h-3 bg-purple-600&#34; style={{ clipPath: &#39;polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)&#39; }}&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;span className=&#34;text-slate-600&#34;&gt;Promoter Gene&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        {/* Right-side legend - Loop resolutions */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;div className=&#34;absolute top-4 right-4 bg-white/90 backdrop-blur-sm p-3 rounded-lg shadow-md border border-slate-200 text-xs&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &lt;div className=&#34;font-bold text-slate-700 mb-2&#34;&gt;Loop Resolution&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &lt;div className=&#34;space-y-1.5&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;div className=&#34;flex items-center gap-2&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;div className=&#34;w-8 h-0.5 bg-teal-600&#34;&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;span className=&#34;text-slate-600&#34;&gt;5K&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;div className=&#34;flex items-center gap-2&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;div className=&#34;w-8 h-0.5 bg-teal-500&#34;&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;span className=&#34;text-slate-600&#34;&gt;10K&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;div className=&#34;flex items-center gap-2&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;div className=&#34;w-8 h-0.5 bg-teal-300&#34;&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;span className=&#34;text-slate-600&#34;&gt;25K&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        {/* Hover tooltip */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        {hoverInfo &amp;&amp; (
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &lt;div
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                className={`absolute px-4 py-3 rounded-lg shadow-xl pointer-events-none z-10 text-sm max-w-xs backdrop-blur-sm border ${hoverInfo.component === &#39;tss&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    ? &#39;bg-pink-50/75 border-pink-200 text-pink-900&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    : &#39;bg-purple-50/75 border-purple-200 text-purple-900&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    }`}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                style={{
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    left: `${hoverInfo.x + 15}px`,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    top: `${hoverInfo.y - 80}px`
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                }}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;div className=&#34;font-bold mb-1&#34;&gt;{hoverInfo.geneName}&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;div className={`text-xs space-y-1 ${hoverInfo.component === &#39;tss&#39; ? &#39;text-pink-800&#39; : &#39;text-purple-800&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    }`}&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;div&gt;{hoverInfo.geneId}&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;div&gt;Position: {hoverInfo.coordinates}&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                    &lt;div&gt;Type: {hoverInfo.component === &#39;tss&#39; ? &#39;TSS&#39; : &#39;Promoter&#39;}&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                        )}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                    &lt;/&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                )}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    );
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+};
</span></span></span></code></pre>
                        </div>
                    
                </section>
            
                <section id="components/ThreeDNA.tsx" class="file-section">
                    <div class="header-container">
                        <header class="file-header">
                            
                                <div class="path">components/ThreeDNA.tsx</div>
                            
                            <button class="goto-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                                <svg aria-hidden="true" focusable="false" width="16" height="16">
                                    <use xlink:href="#arrow-top"></use>
                                </svg>
                                Top
                            </button>
                        </header>
                    </div>
                    
                        <div class="file-diff">
                            <pre class="chroma"><code><span class="line"><span class="cl"><span class="gu">@@ -114,12 +114,12 @@ const DNAStrand = ({ length, radius, isDragging, isFlashing }: { length: number,
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>     &lt;group ref={groupRef}&gt;
</span></span><span class="line"><span class="cl">       {data.map((d, i) =&gt; (
</span></span><span class="line"><span class="cl">         &lt;group key={i}&gt;
</span></span><span class="line"><span class="cl"><span class="gd">-        &lt;FlashSphere
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-          d={d}
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-          ballRadius={ballRadius}
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-          radius={radius}
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-          flashIntensityRef={flashIntensityRef}
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-        /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+          &lt;FlashSphere
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            d={d}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            ballRadius={ballRadius}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            radius={radius}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            flashIntensityRef={flashIntensityRef}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+          /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>         &lt;/group&gt;
</span></span><span class="line"><span class="cl">       ))}
</span></span><span class="line"><span class="cl">     &lt;/group&gt;
</span></span></code></pre>
                        </div>
                    
                </section>
            
                <section id="pages/About.tsx" class="file-section">
                    <div class="header-container">
                        <header class="file-header">
                            
                                <div class="path">pages/About.tsx</div>
                            
                            <button class="goto-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                                <svg aria-hidden="true" focusable="false" width="16" height="16">
                                    <use xlink:href="#arrow-top"></use>
                                </svg>
                                Top
                            </button>
                        </header>
                    </div>
                    
                        <div class="file-diff">
                            <pre class="chroma"><code><span class="line"><span class="cl"><span class="gu">@@ -329,8 +329,11 @@ export const About: React.FC = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>     const openMilestoneModal = (milestone?: Milestone) =&gt; {
</span></span><span class="line"><span class="cl">         if (milestone) {
</span></span><span class="line"><span class="cl">             setEditingMilestone(milestone);
</span></span><span class="line"><span class="cl"><span class="gd">-            const date = new Date(milestone.date);
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-            const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, &#39;0&#39;)}`;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+            // Extract year-month from ISO date string to avoid timezone issues
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const dateStr = milestone.date;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const date = new Date(dateStr);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            // Use UTC methods to avoid timezone conversion issues
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const yearMonth = `${date.getUTCFullYear()}-${String(date.getUTCMonth() + 1).padStart(2, &#39;0&#39;)}`;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>             setMilestoneForm({
</span></span><span class="line"><span class="cl">                 date: yearMonth,
</span></span><span class="line"><span class="cl">                 title: milestone.title,
</span></span><span class="line"><span class="cl"><span class="gu">@@ -521,7 +524,12 @@ export const About: React.FC = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>                                                     {/* Responsive Content Layout */}
</span></span><span class="line"><span class="cl">                                                     &lt;div className=&#34;flex flex-col lg:flex-row lg:items-center lg:gap-4&#34;&gt;
</span></span><span class="line"><span class="cl">                                                         &lt;span className=&#34;text-xs font-bold text-slate-400 mb-2 lg:mb-0 lg:whitespace-nowrap&#34;&gt;
</span></span><span class="line"><span class="cl"><span class="gd">-                                                            {new Date(milestone.date).toLocaleDateString(&#39;en-US&#39;, { year: &#39;numeric&#39;, month: &#39;short&#39; })}
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+                                                            {(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                                                const d = new Date(milestone.date);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                                                const year = d.getUTCFullYear();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                                                const month = d.toLocaleDateString(&#39;en-US&#39;, { month: &#39;short&#39;, timeZone: &#39;UTC&#39; });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                                                return `${month} ${year}`;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                                            })()}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>                                                         &lt;/span&gt;
</span></span><span class="line"><span class="cl">                                                         &lt;div className=&#34;lg:border-l lg:border-slate-300 lg:pl-4 flex-1&#34;&gt;
</span></span><span class="line"><span class="cl">                                                             &lt;h3 className=&#34;text-lg font-bold text-slate-800 mb-2&#34;&gt;{milestone.title}&lt;/h3&gt;
</span></span><span class="line"><span class="cl"><span class="gu">@@ -548,7 +556,12 @@ export const About: React.FC = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>                                                     {/* Responsive Content Layout */}
</span></span><span class="line"><span class="cl">                                                     &lt;div className=&#34;flex flex-col lg:flex-row lg:items-center lg:gap-4&#34;&gt;
</span></span><span class="line"><span class="cl">                                                         &lt;span className=&#34;text-xs font-bold text-slate-400 mb-2 lg:mb-0 lg:whitespace-nowrap&#34;&gt;
</span></span><span class="line"><span class="cl"><span class="gd">-                                                            {new Date(milestone.date).toLocaleDateString(&#39;en-US&#39;, { year: &#39;numeric&#39;, month: &#39;short&#39; })}
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+                                                            {(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                                                const d = new Date(milestone.date);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                                                const year = d.getUTCFullYear();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                                                const month = d.toLocaleDateString(&#39;en-US&#39;, { month: &#39;short&#39;, timeZone: &#39;UTC&#39; });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                                                return `${month} ${year}`;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                                                            })()}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>                                                         &lt;/span&gt;
</span></span><span class="line"><span class="cl">                                                         &lt;div className=&#34;lg:border-l lg:border-slate-300 lg:pl-4 flex-1&#34;&gt;
</span></span><span class="line"><span class="cl">                                                             &lt;h3 className=&#34;text-lg font-bold text-slate-800 mb-2&#34;&gt;{milestone.title}&lt;/h3&gt;
</span></span></code></pre>
                        </div>
                    
                </section>
            
                <section id="pages/Research.tsx" class="file-section">
                    <div class="header-container">
                        <header class="file-header">
                            
                                <div class="path">pages/Research.tsx</div>
                            
                            <button class="goto-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                                <svg aria-hidden="true" focusable="false" width="16" height="16">
                                    <use xlink:href="#arrow-top"></use>
                                </svg>
                                Top
                            </button>
                        </header>
                    </div>
                    
                        <div class="file-diff">
                            <pre class="chroma"><code><span class="line"><span class="cl"><span class="gu">@@ -1,7 +1,8 @@
</span></span></span><span class="line"><span class="cl"><span class="gu"></span> import React, { useState } from &#39;react&#39;;
</span></span><span class="line"><span class="cl"> import { useParams, useNavigate } from &#39;react-router-dom&#39;;
</span></span><span class="line"><span class="cl"> import { ResponsiveContainer, ComposedChart, Line, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ScatterChart, Scatter, ZAxis } from &#39;recharts&#39;;
</span></span><span class="line"><span class="cl"><span class="gd">-import { FileText, GitBranch, Database, Sliders } from &#39;lucide-react&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+import { FileText, GitBranch, Database, Sliders, Search } from &#39;lucide-react&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+import { GenomeVisualizationEnhanced as GenomeVisualization } from &#39;../components/GenomeVisualizationEnhanced&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span> 
</span></span><span class="line"><span class="cl"> const mockInteractionData = Array.from({ length: 50 }, (_, i) =&gt; ({
</span></span><span class="line"><span class="cl">   name: `Loc ${i * 10}kb`,
</span></span><span class="line"><span class="cl"><span class="gu">@@ -19,11 +20,11 @@ const mockScatterData = Array.from({ length: 100 }, () =&gt; ({
</span></span></span><span class="line"><span class="cl"><span class="gu"></span> 
</span></span><span class="line"><span class="cl"> // Removed &#34;card&#34; styling (bg-white, border, shadow) to make it look like a full page section
</span></span><span class="line"><span class="cl"> const PEInteractions = () =&gt; (
</span></span><span class="line"><span class="cl"><span class="gd">-  &lt;div className=&#34;space-y-8 animate-fadeIn py-4&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+  &lt;div className=&#34;space-y-8 animate-fadeIn&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>     &lt;div className=&#34;flex flex-col md:flex-row justify-between items-start md:items-center gap-6 border-b border-slate-100 pb-6&#34;&gt;
</span></span><span class="line"><span class="cl">       &lt;div&gt;
</span></span><span class="line"><span class="cl">         &lt;h3 className=&#34;text-2xl font-bold text-slate-900 flex items-center gap-3&#34;&gt;
</span></span><span class="line"><span class="cl"><span class="gd">-          &lt;GitBranch size={24} className=&#34;text-blue-600&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+          &lt;GitBranch size={24} className=&#34;text-teal-500&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>           PromoterâEnhancer Interaction Mapping
</span></span><span class="line"><span class="cl">         &lt;/h3&gt;
</span></span><span class="line"><span class="cl">         &lt;p className=&#34;text-slate-500 mt-2 text-lg&#34;&gt;Interactive Visualization simulating R Shiny output from &lt;code className=&#34;bg-slate-100 px-2 py-1 rounded text-sm&#34;&gt;enhancer_promoter_interaction.R&lt;/code&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl"><span class="gu">@@ -73,10 +74,10 @@ const PEInteractions = () =&gt; (
</span></span></span><span class="line"><span class="cl"><span class="gu"></span> );
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> const SingleCell = () =&gt; (
</span></span><span class="line"><span class="cl"><span class="gd">-  &lt;div className=&#34;space-y-8 animate-fadeIn py-4&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+  &lt;div className=&#34;space-y-8 animate-fadeIn&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>     &lt;div className=&#34;border-b border-slate-100 pb-6&#34;&gt;
</span></span><span class="line"><span class="cl">       &lt;h3 className=&#34;text-2xl font-bold text-slate-900 flex items-center gap-3&#34;&gt;
</span></span><span class="line"><span class="cl"><span class="gd">-        &lt;Database size={24} className=&#34;text-green-600&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+        &lt;Database size={24} className=&#34;text-teal-500&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>         Single-cell Sequencing Analysis
</span></span><span class="line"><span class="cl">       &lt;/h3&gt;
</span></span><span class="line"><span class="cl">       &lt;p className=&#34;text-slate-500 mt-2 text-lg&#34;&gt;Dimensionality reduction (UMAP) and clustering of 10k PBMCs.&lt;/p&gt;
</span></span><span class="line"><span class="cl"><span class="gu">@@ -108,10 +109,10 @@ const SingleCell = () =&gt; (
</span></span></span><span class="line"><span class="cl"><span class="gu"></span> );
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> const EnhancerID = () =&gt; (
</span></span><span class="line"><span class="cl"><span class="gd">-  &lt;div className=&#34;space-y-8 animate-fadeIn py-4&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+  &lt;div className=&#34;space-y-8 animate-fadeIn&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>     &lt;div className=&#34;border-b border-slate-100 pb-6&#34;&gt;
</span></span><span class="line"><span class="cl">       &lt;h3 className=&#34;text-2xl font-bold text-slate-900 flex items-center gap-3&#34;&gt;
</span></span><span class="line"><span class="cl"><span class="gd">-        &lt;FileText size={24} className=&#34;text-pink-600&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+        &lt;FileText size={24} className=&#34;text-teal-500&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>         Computational Enhancer Identification
</span></span><span class="line"><span class="cl">       &lt;/h3&gt;
</span></span><span class="line"><span class="cl">       &lt;p className=&#34;text-slate-500 mt-2 text-lg&#34;&gt;Deep learning prediction of enhancer regions using sequence motifs and conservation.&lt;/p&gt;
</span></span><span class="line"><span class="cl"><span class="gu">@@ -167,14 +168,38 @@ export const Research: React.FC = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>   const tabs = [
</span></span><span class="line"><span class="cl">     { label: &#39;PE Interactions&#39;, icon: GitBranch, color: &#39;text-teal-500 border-teal-500&#39;, activeBg: &#39;bg-teal-50 ring-teal-200&#39;, slug: &#39;peinteractions&#39; },
</span></span><span class="line"><span class="cl">     { label: &#39;Single-cell Seq&#39;, icon: Database, color: &#39;text-teal-500 border-teal-500&#39;, activeBg: &#39;bg-teal-50 ring-teal-200&#39;, slug: &#39;singlecellseq&#39; },
</span></span><span class="line"><span class="cl"><span class="gd">-    { label: &#39;Enhancer ID&#39;, icon: FileText, color: &#39;text-teal-500 border-teal-500&#39;, activeBg: &#39;bg-teal-50 ring-teal-200&#39;, slug: &#39;deeplearningenhancer&#39; },
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-    { label: &#39;LLM&#39;, icon: Sliders, color: &#39;text-teal-500 border-teal-500&#39;, activeBg: &#39;bg-teal-50 ring-teal-200&#39;, slug: &#39;llm&#39; },
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+    { label: &#39;DL &amp; Enhancer&#39;, icon: FileText, color: &#39;text-teal-500 border-teal-500&#39;, activeBg: &#39;bg-teal-50 ring-teal-200&#39;, slug: &#39;deeplearningenhancer&#39; },
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    { label: &#39;Hi-C Browser&#39;, icon: Search, color: &#39;text-teal-500 border-teal-500&#39;, activeBg: &#39;bg-teal-50 ring-teal-200&#39;, slug: &#39;hicbrowser&#39; },
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>   ];
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   // Determine active tab from URL, default to first tab
</span></span><span class="line"><span class="cl">   const activeTabIndex = tabs.findIndex(tab =&gt; tab.slug === submenu);
</span></span><span class="line"><span class="cl">   const activeTab = activeTabIndex !== -1 ? activeTabIndex : 0;
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="gi">+  // Prefetch initial genome data (chr1) in background when Research page loads
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  React.useEffect(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const prefetchInitialData = async () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Import dynamically to avoid blocking main bundle if possible, 
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // but here we just use the imported functions if we were to import them at top level.
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Since we need to modify imports, let&#39;s assume we&#39;ll add imports at the top.
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const { loadChromosomeData, loadLoopDataForChr, loadGeneDataForChr } = await import(&#39;../utils/csvLoader&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Load chromosome list and chr1 data (default view)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        await Promise.all([
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+          loadChromosomeData(),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+          loadLoopDataForChr(&#39;chr1&#39;),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+          loadGeneDataForChr(&#39;chr1&#39;)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        console.log(&#39;Initial genome data prefetched&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        console.error(&#39;Failed to prefetch genome data:&#39;, error);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    prefetchInitialData();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  }, []);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>   return (
</span></span><span class="line"><span class="cl">     &lt;div className=&#34;flex flex-col h-screen bg-white&#34;&gt;
</span></span><span class="line"><span class="cl">       {/* Fixed Header Section */}
</span></span><span class="line"><span class="cl"><span class="gu">@@ -210,9 +235,6 @@ export const Research: React.FC = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>         &lt;/div&gt;
</span></span><span class="line"><span class="cl">       &lt;/div&gt;
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="gd">-      &lt;div className=&#34;max-w-7xl mx-auto px-6 pb-4&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-      &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-
</span></span></span><span class="line"><span class="cl"><span class="gd"></span>       {/* Scrollable Content Area */}
</span></span><span class="line"><span class="cl">       &lt;div className=&#34;flex-1 overflow-y-auto px-6 pb-20&#34;&gt;
</span></span><span class="line"><span class="cl">         &lt;div className=&#34;max-w-7xl mx-auto pt-8&#34;&gt;
</span></span><span class="line"><span class="cl"><span class="gu">@@ -220,12 +242,20 @@ export const Research: React.FC = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>           {activeTab === 1 &amp;&amp; &lt;SingleCell /&gt;}
</span></span><span class="line"><span class="cl">           {activeTab === 2 &amp;&amp; &lt;EnhancerID /&gt;}
</span></span><span class="line"><span class="cl">           {activeTab === 3 &amp;&amp; (
</span></span><span class="line"><span class="cl"><span class="gd">-            &lt;div className=&#39;p-8&#39;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-              &lt;h3 className=&#39;text-2xl font-bold mb-4 flex items-center gap-3&#39;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-                &lt;Sliders size={24} className=&#34;text-purple-600&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-                LLM Research
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-              &lt;/h3&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gd">-              &lt;p className=&#39;text-slate-600&#39;&gt;Content for LLM research goes here.&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+            &lt;div className=&#39;space-y-8 animate-fadeIn&#39;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+              &lt;div className=&#34;border-b border-slate-100 pb-6&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;h3 className=&#39;text-2xl font-bold text-slate-900 flex items-center gap-3&#39;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                  &lt;Search size={24} className=&#34;text-teal-500&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                  Hi-C Browser - Chromatin Loops &amp; Gene Regulation
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/h3&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;p className=&#39;text-slate-500 mt-2 text-lg&#39;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                  Interactive visualization of chromatin loops, TSS/Promoter locations, and gene exon positions
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+              &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+              &lt;div className=&#39;h-[500px] flex flex-col&#39;&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                &lt;GenomeVisualization /&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+              &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>             &lt;/div&gt;
</span></span><span class="line"><span class="cl">           )}
</span></span><span class="line"><span class="cl">         &lt;/div&gt;
</span></span></code></pre>
                        </div>
                    
                </section>
            
                <section id="utils/csvLoader.ts" class="file-section">
                    <div class="header-container">
                        <header class="file-header">
                            
                                <div class="path">utils/csvLoader.ts</div>
                            
                            <button class="goto-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                                <svg aria-hidden="true" focusable="false" width="16" height="16">
                                    <use xlink:href="#arrow-top"></use>
                                </svg>
                                Top
                            </button>
                        </header>
                    </div>
                    
                        <div class="file-diff">
                            <pre class="chroma"><code><span class="line"><span class="cl"><span class="gu">@@ -0,0 +1,274 @@
</span></span></span><span class="line"><span class="cl"><span class="gu"></span><span class="gi">+// Utility functions to load and parse CSV data
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// Base URL for CSV data files
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+const CSV_BASE_URL = &#39;https://storage.googleapis.com/distilledchild/research/hic-browser/&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+export interface LoopDataRow {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    loop_id: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    chr1: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    x1: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    x2: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    chr2: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    y1: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    y2: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    end_distance?: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    distance?: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    resolution?: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    x0?: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    x3?: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    y0?: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    y3?: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    chr_end_coord?: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    start?: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+export interface ChromosomeDataRow {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    chr: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    end: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    start: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+export interface GeneDataRow {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    chr: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    start: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    end: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    gene_id: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    gene_name: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    component_id: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    ensembl_exon_id: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    refseq_exon_id: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    component: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    gene_chr: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    gene_start: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    gene_end: number;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    gene_strand: string;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// Cache for loaded data
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+const dataCache: {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    loops: { [key: string]: LoopDataRow[] };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    genes: { [key: string]: GeneDataRow[] };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    chromosomes: ChromosomeDataRow[] | null;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+} = {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    loops: {},
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    genes: {},
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    chromosomes: null
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+};
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// Parse CSV text to array of objects
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+function parseCSV(csvText: string): any[] {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const lines = csvText.trim().split(&#39;\n&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    if (lines.length &lt; 2) return [];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const headers = lines[0].split(&#39;,&#39;).map(h =&gt; h.trim().replace(/&#34;/g, &#39;&#39;));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const rows: any[] = [];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    for (let i = 1; i &lt; lines.length; i++) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const values = lines[i].split(&#39;,&#39;).map(v =&gt; v.trim().replace(/&#34;/g, &#39;&#39;));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const row: any = {};
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        headers.forEach((header, index) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const value = values[index];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            // Try to parse as number if possible
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            const numValue = parseFloat(value);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            row[header] = isNaN(numValue) ? value : numValue;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        rows.push(row);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    return rows;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// Load loop data from CSV
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+export async function loadLoopData(): Promise&lt;LoopDataRow[]&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    if (dataCache.loops[&#39;all&#39;]) return dataCache.loops[&#39;all&#39;];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const response = await fetch(`${CSV_BASE_URL}loop_data.csv`);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!response.ok) throw new Error(&#39;Failed to load loop data&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const csvText = await response.text();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const rows = parseCSV(csvText);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const data = rows.map(row =&gt; ({
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            loop_id: row.loop_id || row[&#39;loop.id&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            chr1: row.chr1,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            x1: Number(row.x1),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            x2: Number(row.x2),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            chr2: row.chr2,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            y1: Number(row.y1),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            y2: Number(row.y2),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            end_distance: row.end_distance || row[&#39;end.distance&#39;],
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            distance: row.distance,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            resolution: row.resolution,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            x0: row.x0,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            x3: row.x3,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            y0: row.y0,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            y3: row.y3,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            chr_end_coord: row.chr_end_coord || row[&#39;chr.end.coord&#39;],
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            start: row.start
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        dataCache.loops[&#39;all&#39;] = data;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return data;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        console.error(&#39;Error loading loop data:&#39;, error);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return [];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// Load chromosome data from CSV
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+export async function loadChromosomeData(): Promise&lt;ChromosomeDataRow[]&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    if (dataCache.chromosomes) return dataCache.chromosomes;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const response = await fetch(`${CSV_BASE_URL}chromosome_data.csv`);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!response.ok) throw new Error(&#39;Failed to load chromosome data&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const csvText = await response.text();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const rows = parseCSV(csvText);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const data = rows.map(row =&gt; ({
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            chr: row.chr,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            end: Number(row.end),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            start: Number(row.start)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        dataCache.chromosomes = data;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return data;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        console.error(&#39;Error loading chromosome data:&#39;, error);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return [];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// Load gene TSS/promoter data from CSV
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+export async function loadGeneData(): Promise&lt;GeneDataRow[]&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    if (dataCache.genes[&#39;all&#39;]) return dataCache.genes[&#39;all&#39;];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const response = await fetch(`${CSV_BASE_URL}gene_tss_and_pro.csv`);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!response.ok) throw new Error(&#39;Failed to load gene data&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const csvText = await response.text();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const rows = parseCSV(csvText);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const data = rows.map(row =&gt; ({
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            chr: row.chr,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            start: Number(row.start),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            end: Number(row.end),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            gene_id: row.gene_id || row[&#39;gene.id&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            gene_name: row.gene_name || row[&#39;gene.name&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            component_id: row.component_id || row[&#39;component.id&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            ensembl_exon_id: row.ensembl_exon_id || row[&#39;ensembl.exon.id&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            refseq_exon_id: row.refseq_exon_id || row[&#39;refseq.exon.id&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            component: row.component,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            gene_chr: row.gene_chr || row[&#39;gene.chr&#39;] || row.chr,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            gene_start: Number(row.gene_start || row[&#39;gene.start&#39;] || row.start),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            gene_end: Number(row.gene_end || row[&#39;gene.end&#39;] || row.end),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            gene_strand: row.gene_strand || row[&#39;gene.strand&#39;] || &#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        dataCache.genes[&#39;all&#39;] = data;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return data;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        console.error(&#39;Error loading gene data:&#39;, error);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return [];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// Load loop data for a specific chromosome
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+export async function loadLoopDataForChr(chr: string): Promise&lt;LoopDataRow[]&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    if (dataCache.loops[chr]) return dataCache.loops[chr];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const response = await fetch(`${CSV_BASE_URL}loop_data_${chr}.csv`);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!response.ok) throw new Error(`Failed to load loop data for ${chr}`);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const csvText = await response.text();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const rows = parseCSV(csvText);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const data = rows.map(row =&gt; ({
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            loop_id: row.loop_id || row[&#39;loop.id&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            chr1: row.chr1,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            x1: Number(row.x1),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            x2: Number(row.x2),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            chr2: row.chr2,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            y1: Number(row.y1),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            y2: Number(row.y2),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            end_distance: row.end_distance || row[&#39;end.distance&#39;],
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            distance: row.distance,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            resolution: row.resolution,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            x0: row.x0,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            x3: row.x3,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            y0: row.y0,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            y3: row.y3,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            chr_end_coord: row.chr_end_coord || row[&#39;chr.end.coord&#39;],
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            start: row.start
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        dataCache.loops[chr] = data;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return data;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        console.error(`Error loading loop data for ${chr}:`, error);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return [];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// Load gene TSS/promoter data for a specific chromosome
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+export async function loadGeneDataForChr(chr: string): Promise&lt;GeneDataRow[]&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    if (dataCache.genes[chr]) return dataCache.genes[chr];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const response = await fetch(`${CSV_BASE_URL}gene_tss_and_pro_${chr}.csv`);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (!response.ok) throw new Error(`Failed to load gene data for ${chr}`);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const csvText = await response.text();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const rows = parseCSV(csvText);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const data = rows.map(row =&gt; ({
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            chr: row.chr,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            start: Number(row.start),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            end: Number(row.end),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            gene_id: row.gene_id || row[&#39;gene.id&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            gene_name: row.gene_name || row[&#39;gene.name&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            component_id: row.component_id || row[&#39;component.id&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            ensembl_exon_id: row.ensembl_exon_id || row[&#39;ensembl.exon.id&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            refseq_exon_id: row.refseq_exon_id || row[&#39;refseq.exon.id&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            component: row.component,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            gene_chr: row.gene_chr || row[&#39;gene.chr&#39;] || &#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            gene_start: Number(row.gene_start || row[&#39;gene.start&#39;] || 0),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            gene_end: Number(row.gene_end || row[&#39;gene.end&#39;] || 0),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            gene_strand: row.gene_strand || row[&#39;gene.strand&#39;] || &#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        dataCache.genes[chr] = data;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return data;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        console.error(`Error loading gene data for ${chr}:`, error);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        return [];
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// Prefetch all chromosomes in background
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+export async function prefetchAllChromosomes(chromosomes: string[]) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    for (const chr of chromosomes) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Skip if already cached
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        if (dataCache.loops[chr] &amp;&amp; dataCache.genes[chr]) continue;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Load in background with low priority
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            await Promise.all([
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                loadLoopDataForChr(chr),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+                loadGeneDataForChr(chr)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            ]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            console.log(`Prefetched data for ${chr}`);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        } catch (e) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            console.warn(`Failed to prefetch ${chr}`, e);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Small delay to yield to main thread
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        await new Promise(resolve =&gt; setTimeout(resolve, 100));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}
</span></span></span></code></pre>
                        </div>
                    
                </section>
            
                <section id=".gitignore" class="file-section">
                    <div class="header-container">
                        <header class="file-header">
                            
                                <div class="path">.gitignore</div>
                            
                            <button class="goto-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                                <svg aria-hidden="true" focusable="false" width="16" height="16">
                                    <use xlink:href="#arrow-top"></use>
                                </svg>
                                Top
                            </button>
                        </header>
                    </div>
                    
                        <div class="file-diff">
                            <pre class="chroma"><code><span class="line"><span class="cl"><span class="gu">@@ -23,4 +23,5 @@ dist-ssr
</span></span></span><span class="line"><span class="cl"><span class="gu"></span> *.sln
</span></span><span class="line"><span class="cl"> *.sw?
</span></span><span class="line"><span class="cl"> .env*
</span></span><span class="line"><span class="cl"><span class="gd">-*-key.json
</span></span></span><span class="line"><span class="cl"><span class="gd"></span>\ No newline at end of file
</span></span><span class="line"><span class="cl"><span class="gi">+*-key.json
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+public/data
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>\ No newline at end of file
</span></span></code></pre>
                        </div>
                    
                </section>
            
                <section id="App.tsx" class="file-section">
                    <div class="header-container">
                        <header class="file-header">
                            
                                <div class="path">App.tsx</div>
                            
                            <button class="goto-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                                <svg aria-hidden="true" focusable="false" width="16" height="16">
                                    <use xlink:href="#arrow-top"></use>
                                </svg>
                                Top
                            </button>
                        </header>
                    </div>
                    
                        <div class="file-diff">
                            <pre class="chroma"><code><span class="line"><span class="cl"><span class="gu">@@ -38,7 +38,7 @@ const Home: React.FC = () =&gt; (
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>     {/* Instruction Text - Centered and Animated */}
</span></span><span class="line"><span class="cl">     &lt;div className=&#34;absolute bottom-9 left-1/2 -translate-x-1/2 z-20 pointer-events-none select-none hidden md:block&#34;&gt;
</span></span><span class="line"><span class="cl">       &lt;p className=&#34;text-lg md:text-xl text-white font-light animate-double-blink&#34;&gt;
</span></span><span class="line"><span class="cl"><span class="gd">-        Drag or Zoom to interact
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+        Drag or Scroll to Interact!!
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>       &lt;/p&gt;
</span></span><span class="line"><span class="cl">     &lt;/div&gt;
</span></span><span class="line"><span class="cl">   &lt;/div&gt;
</span></span><span class="line"><span class="cl"><span class="gu">@@ -2490,7 +2490,15 @@ const Layout: React.FC = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gu"></span>       {/* Branding Logo - Visible on ALL pages top left */}
</span></span><span class="line"><span class="cl">       &lt;div className=&#34;fixed top-0 left-0 z-50 p-4 md:p-8 flex items-center&#34;&gt;
</span></span><span class="line"><span class="cl">         &lt;Link to=&#34;/&#34; className=&#34;font-extrabold tracking-tighter flex items-center text-slate-900&#34; style={{ fontSize: &#39;clamp(1.5rem, 4vw, 2.4rem)&#39; }}&gt;
</span></span><span class="line"><span class="cl"><span class="gd">-          &lt;span className=&#34;text-green-500&#34;&gt;Distilled&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+          {/* &lt;span className=&#34;text-green-500&#34;&gt;Distilled&lt;/span&gt; */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+          &lt;span
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            className=&#34;text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-green-400 to-purple-400 animate-gradient&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            style={{
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+              WebkitBackgroundClip: &#39;text&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+              WebkitTextFillColor: &#39;transparent&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+              backgroundClip: &#39;text&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            }}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+          &gt;Distilled&lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>           &lt;span className=&#34;text-[#0D1584]&#34;&gt;Child&lt;/span&gt;
</span></span><span class="line"><span class="cl">         &lt;/Link&gt;
</span></span><span class="line"><span class="cl">       &lt;/div&gt;
</span></span></code></pre>
                        </div>
                    
                </section>
            
                <section id="gcs-cors-config.json" class="file-section">
                    <div class="header-container">
                        <header class="file-header">
                            
                                <div class="path">gcs-cors-config.json</div>
                            
                            <button class="goto-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                                <svg aria-hidden="true" focusable="false" width="16" height="16">
                                    <use xlink:href="#arrow-top"></use>
                                </svg>
                                Top
                            </button>
                        </header>
                    </div>
                    
                        <div class="file-diff">
                            <pre class="chroma"><code><span class="line"><span class="cl"><span class="gu">@@ -0,0 +1,18 @@
</span></span></span><span class="line"><span class="cl"><span class="gu"></span><span class="gi">+[
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        &#34;origin&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &#34;http://localhost:3000&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &#34;https://www.distilledchild.space&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &#34;https://distilledchild.space&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ],
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        &#34;method&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &#34;GET&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &#34;HEAD&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ],
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        &#34;responseHeader&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &#34;Content-Type&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+            &#34;Access-Control-Allow-Origin&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ],
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        &#34;maxAgeSeconds&#34;: 3600
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+]
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>\ No newline at end of file
</span></span></code></pre>
                        </div>
                    
                </section>
            
                <section id="GENOME_VISUALIZATION_DATA_GUIDE.md" class="file-section">
                    <div class="header-container">
                        <header class="file-header">
                            
                                <div class="path">GENOME_VISUALIZATION_DATA_GUIDE.md</div>
                            
                            <button class="goto-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                                <svg aria-hidden="true" focusable="false" width="16" height="16">
                                    <use xlink:href="#arrow-top"></use>
                                </svg>
                                Top
                            </button>
                        </header>
                    </div>
                    
                        <div class="file-diff">
                            <pre class="chroma"><code><span class="line"><span class="cl"><span class="gu">@@ -0,0 +1,289 @@
</span></span></span><span class="line"><span class="cl"><span class="gu"></span><span class="gi">+# Genome Visualization - Data Integration Guide
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+## Overview
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+The genome visualization component displays chromatin loops, TSS/promoters, and gene exon locations on an interactive chromosome browser.
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+## How to Use Your Own Data
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Step 1: Prepare Your Data Files
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+You have three datasets:
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+1. **Gene TSS and Promoter Data** (`df.gene_tss_and_pro`)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+2. **Chromatin Loop Data** (`df.DISTINCT.loop.deep.sample.all.lt.2mb.prep`)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+3. **Chromosome Length Data** (`chromosome_data`)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Step 2: Export Data from R to JSON
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+In your R environment, export the data to JSON format:
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```r
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+# Install jsonlite if not already installed
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+if (!require(&#34;jsonlite&#34;)) install.packages(&#34;jsonlite&#34;)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+library(jsonlite)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+# Export gene TSS/promoter data
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+gene_data_json &lt;- df.gene_tss_and_pro %&gt;%
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  select(chr, start, end, gene_id, gene_name, component_id, 
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+         ensembl_exon_id, refseq_exon_id, component) %&gt;%
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  toJSON(pretty = TRUE)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+write(gene_data_json, &#34;gene_data.json&#34;)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+# Export loop data
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+loop_data_json &lt;- df.DISTINCT.loop.deep.sample.all.lt.2mb.prep %&gt;%
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  select(loop_id, chr1, x1, x2, chr2, y1, y2) %&gt;%
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  toJSON(pretty = TRUE)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+write(loop_data_json, &#34;loop_data.json&#34;)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+# Export chromosome data
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+chrom_data_json &lt;- chromosome_data %&gt;%
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  filter(chr == &#34;chr12&#34;) %&gt;%  # or whichever chromosome you want
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  toJSON(pretty = TRUE)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+write(chrom_data_json, &#34;chromosome_data.json&#34;)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Step 3: Create API Endpoints (Optional - for Large Datasets)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+For large datasets, create backend API endpoints in `server/index.js`:
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```javascript
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// Add these routes to your server/index.js
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+app.get(&#39;/api/genome/genes/:chr&#39;, async (req, res) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const { chr } = req.params;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    // Read from your JSON file or database
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const geneData = require(&#39;./data/gene_data.json&#39;).filter(g =&gt; g.chr === chr);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    res.json(geneData);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    res.status(500).json({ error: error.message });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+});
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+app.get(&#39;/api/genome/loops/:chr&#39;, async (req, res) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const { chr } = req.params;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const loopData = require(&#39;./data/loop_data.json&#39;).filter(l =&gt; l.chr1 === chr);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    res.json(loopData);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    res.status(500).json({ error: error.message });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+});
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+app.get(&#39;/api/genome/chromosome/:chr&#39;, async (req, res) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const { chr } = req.params;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const chromData = require(&#39;./data/chromosome_data.json&#39;).find(c =&gt; c.chr === chr);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    res.json(chromData);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    res.status(500).json({ error: error.message });
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+});
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Step 4: Update the GenomeVisualization Component
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+Modify `/components/GenomeVisualization.tsx` to load your data:
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```typescript
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+import React, { useRef, useEffect, useState } from &#39;react&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+import { ZoomIn, ZoomOut, RotateCcw } from &#39;lucide-react&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+export const GenomeVisualization: React.FC = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  const [geneData, setGeneData] = useState&lt;GeneData[]&gt;([]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  const [loopData, setLoopData] = useState&lt;LoopData[]&gt;([]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  const [chromosomeData, setChromosomeData] = useState&lt;ChromosomeData | null&gt;(null);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  const [loading, setLoading] = useState(true);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  // Fetch data on component mount
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  useEffect(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    const fetchData = async () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const API_URL = window.location.hostname === &#39;localhost&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+          ? &#39;http://localhost:4000&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+          : &#39;https://your-production-url.com&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const chr = &#39;chr12&#39;; // Change this to allow user selection
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        // Fetch all data
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        const [genes, loops, chrom] = await Promise.all([
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+          fetch(`${API_URL}/api/genome/genes/${chr}`).then(r =&gt; r.json()),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+          fetch(`${API_URL}/api/genome/loops/${chr}`).then(r =&gt; r.json()),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+          fetch(`${API_URL}/api/genome/chromosome/${chr}`).then(r =&gt; r.json())
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        ]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setGeneData(genes);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setLoopData(loops);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setChromosomeData(chrom);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setLoading(false);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        console.error(&#39;Failed to load genome data:&#39;, error);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        setLoading(false);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    fetchData();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  }, []);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  if (loading) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    return &lt;div className=&#34;flex items-center justify-center h-full&#34;&gt;Loading genome data...&lt;/div&gt;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  // ... rest of the component code
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+};
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Step 5: Direct Data Import (For Smaller Datasets)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+For smaller datasets, you can import the JSON directly:
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+1. Place your JSON files in `/public/data/`:
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+   - `/public/data/gene_data.json`
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+   - `/public/data/loop_data.json`
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+   - `/public/data/chromosome_data.json`
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+2. Update the component to fetch from public folder:
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```typescript
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+useEffect(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  const fetchData = async () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    try {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      const [genes, loops, chrom] = await Promise.all([
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        fetch(&#39;/data/gene_data.json&#39;).then(r =&gt; r.json()),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        fetch(&#39;/data/loop_data.json&#39;).then(r =&gt; r.json()),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+        fetch(&#39;/data/chromosome_data.json&#39;).then(r =&gt; r.json())
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      ]);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      // Filter for chr12 if needed
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      setGeneData(genes.filter(g =&gt; g.chr === &#39;chr12&#39;));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      setLoopData(loops.filter(l =&gt; l.chr1 === &#39;chr12&#39;));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      setChromosomeData(chrom.find(c =&gt; c.chr === &#39;chr12&#39;));
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      setLoading(false);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    } catch (error) {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      console.error(&#39;Failed to load genome data:&#39;, error);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+      setLoading(false);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  };
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  fetchData();
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+}, []);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+## Data Format Requirements
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Gene Data Format
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```json
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+[
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;chr&#34;: &#34;chr12&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;start&#34;: 25000000,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;end&#34;: 25000002,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;gene_id&#34;: &#34;ENSRNOG00000000001&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;gene_name&#34;: &#34;Gene1&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;component_id&#34;: &#34;chr12:25000000:25000002:+:ENSRNOG00000000001:Gene1|tss&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;ensembl_exon_id&#34;: &#34;chr12:25500000:25505000:Gene1:ENSRNOG00000000001:1&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;refseq_exon_id&#34;: &#34;NA&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;component&#34;: &#34;tss&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+]
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Loop Data Format
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```json
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+[
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;loop_id&#34;: &#34;chr12_20000000_20500000_chr12_30000000_30500000_25000&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;chr1&#34;: &#34;chr12&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;x1&#34;: 20000000,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;x2&#34;: 20500000,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;chr2&#34;: &#34;chr12&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;y1&#34;: 30000000,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;y2&#34;: 30500000
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+]
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Chromosome Data Format
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```json
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+[
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  {
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;chr&#34;: &#34;chr12&#34;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;end&#34;: 120000000,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+    &#34;start&#34;: 0
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+]
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+## Features
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+- **Zoom In/Out**: Use buttons or mouse wheel to zoom
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+- **Pan**: Click and drag to pan along the chromosome
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+- **Hover Info**: Hover over TSS/promoter markers to see gene details
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+- **Loops**: Chromatin loops shown as blue parabolic arcs
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+- **Gene Connections**: Dashed lines connect TSS/promoters to their corresponding exons on hover
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+## Customization
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Change Chromosome
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+Add a dropdown selector to switch between chromosomes:
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```typescript
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+const [selectedChr, setSelectedChr] = useState(&#39;chr12&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// In your JSX
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+&lt;select 
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  value={selectedChr} 
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  onChange={(e) =&gt; setSelectedChr(e.target.value)}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  className=&#34;px-4 py-2 border rounded&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  &lt;option value=&#34;chr1&#34;&gt;Chromosome 1&lt;/option&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  &lt;option value=&#34;chr2&#34;&gt;Chromosome 2&lt;/option&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+  {/* ... more chromosomes */}
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+&lt;/select&gt;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Adjust Colors
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+Colors are defined in the `drawGenes` and `drawLoops` functions:
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```typescript
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// TSS color
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+const color = gene.component === &#39;tss&#39; ? &#39;#ec4899&#39; : &#39;#8b5cf6&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// Loop color
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+ctx.strokeStyle = &#39;#3b82f6&#39;;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Modify Arc Height
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+Adjust the parabolic arc height in the drawing functions:
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```typescript
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// For loops
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+const arcHeight = Math.min(Math.abs(x2 - x1) * 0.3, 200); // Change 0.3 or 200
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+// For gene-exon connections
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+const arcHeight = Math.min(Math.abs(exonMidX - geneX) * 0.2, 100); // Change 0.2 or 100
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+```
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+## Troubleshooting
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Data Not Showing
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+1. Check browser console for errors
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+2. Verify JSON file paths are correct
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+3. Ensure data matches the expected format
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+4. Check that chromosome names match (e.g., &#34;chr12&#34; vs &#34;12&#34;)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Performance Issues
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+- Filter data to show only visible region
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+- Implement data pagination for large datasets
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+- Use Web Workers for data processing
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+### Incorrect Positioning
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+- Verify coordinate values are integers
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+- Check that exon coordinates are properly formatted in the exon_id string
</span></span></span><span class="line"><span class="cl"><span class="gi"></span><span class="gi">+- Ensure chromosome start is 0
</span></span></span></code></pre>
                        </div>
                    
                </section>
            
        </div>
    </div>

    </div>
</main>
<footer>
    Generated by <a href="https://github.com/antonmedv/gitmal">Gitmal</a>
</footer>
</body>
</html>
